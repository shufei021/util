<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexDB Example</title>
    <script type="module">
        import { indexdb } from './indexdb.js'; // 确保路径正确

        document.addEventListener('DOMContentLoaded', async () => {
            const dbConfig = {
                dbName: 'TestDB',
                dbVersion: 1,
                storeName: 'TestStore',
                keyPath: 'id',
                indexes: [
                    { name: 'nameIndex', keyPath: 'name', options: { unique: false } }
                ],
                handleVersionUpgrade: (db, oldVersion, newVersion) => {
                    console.log(`Upgrading from version ${oldVersion} to ${newVersion}`);
                }
            };

            const db = indexdb(dbConfig);

            // 添加数据
            document.getElementById('addData').addEventListener('click', async () => {
                const data = { id: '1', name: 'John Doe', age: 30 };
                await db.add(data);
                console.log('Data added:', data);
            });

            // 获取数据
            document.getElementById('getData').addEventListener('click', async () => {
                const key = '1';
                const data = await db.get(key);
                console.log('Data retrieved:', data);
            });

            // 更新数据
            document.getElementById('updateData').addEventListener('click', async () => {
                const data = { id: '1', name: 'Jane Doe', age: 31 };
                await db.put(data);
                console.log('Data updated:', data);
            });

            // 删除数据
            document.getElementById('deleteData').addEventListener('click', async () => {
                const key = '1';
                await db.del(key);
                console.log('Data deleted with key:', key);
            });

            // 清空数据
            document.getElementById('clearData').addEventListener('click', async () => {
                await db.clear();
                console.log('All data cleared');
            });

            // 使用索引查询
            document.getElementById('queryByIndex').addEventListener('click', async () => {
                const results = await db.getByIndex('nameIndex', 'Jane Doe');
                console.log('Query results:', results);
            });

            // 范围查询
            document.getElementById('rangeQuery').addEventListener('click', async () => {
                const results = await db.rangeQuery('nameIndex', { start: 'A', end: 'Z' });
                console.log('Range query results:', results);
            });

            // 批量添加
            document.getElementById('bulkAdd').addEventListener('click', async () => {
                const items = [
                    { id: '2', name: 'Alice', age: 25 },
                    { id: '3', name: 'Bob', age: 28 }
                ];
                await db.bulkAdd(items);
                console.log('Bulk data added:', items);
            });

            // 批量获取
            document.getElementById('bulkGet').addEventListener('click', async () => {
                const keys = ['2', '3'];
                const data = await db.bulkGet(keys);
                console.log('Bulk data retrieved:', data);
            });

            // 删除存储空间
            document.getElementById('deleteStore').addEventListener('click', async () => {
                await db.deleteStore('TestStore');
                console.log('Store deleted');
            });

            // 销毁数据库连接
            document.getElementById('destroyDB').addEventListener('click', () => {
                db.destroy();
                console.log('Database connection destroyed');
            });
        });
    </script>
</head>
<body>
    <h1>IndexDB Example</h1>
    <button id="addData">Add Data</button>
    <button id="getData">Get Data</button>
    <button id="updateData">Update Data</button>
    <button id="deleteData">Delete Data</button>
    <button id="clearData">Clear Data</button>
    <button id="queryByIndex">Query by Index</button>
    <button id="rangeQuery">Range Query</button>
    <button id="bulkAdd">Bulk Add</button>
    <button id="bulkGet">Bulk Get</button>
    <button id="deleteStore">Delete Store</button>
    <button id="destroyDB">Destroy DB</button>
</body>
</html>