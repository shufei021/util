!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rutils={})}(this,(function(e){"use strict";const t=function(e,t){if(!Array.isArray(e))throw new Error("传入的第一个参数必须为数组类型");if(void 0!==t&&"string"!=typeof t)throw new Error("传入的第二个参数必须为字符串类型");const r=new Map;return e.filter((e=>{const i=t?e[t]:JSON.stringify(e);return!r.has(i)&&(r.set(i,!0),!0)}))},r=function(e,t){const i=Array.isArray(e)?[...e]:[e],n=t.children||"children";for(;i.length;){const e=i.shift();t.cb?t.cb(e,r):t&&t(e,r),e&&e[n]&&e[n].length&&e[n].forEach((e=>i.push(e)))}};const i=function(e){const t=(e,t)=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase()===t,r=[],i=[],n=e=>{if(null===e)return null;if("object"!=typeof e&&"function"!=typeof e)return e;let s,o;t(e,"array")?s=[]:t(e,"regexp")?(s=new e.constructor(e.source,/\w*$/.exec(e)),e.lastIndex&&(s.lastIndex=e.lastIndex)):t(e,"date")?s=new Date(e.getTime()):t(e,"function")?(o=Object.getPrototypeOf(e),s=function(e){const t=new Function("return "+e.toString())();t.prototype=Object.create(e.prototype);for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(e)):(o=Object.getPrototypeOf(e),s=Object.create(o));const a=r.indexOf(e);if(-1!==a)return i[a];r.push(e),i.push(s);for(const t in e)s[t]=n(e[t]);return s};return n(e)};const n=window.navigator.userAgent,s=!!n.match(/Chrome/i),o=!!(n.match(/(iPhone|iPad|iPod)/i)||n.match(/Android/i)||n.match(/Windows Phone/i)||n.match(/IEMobile/i)),a=!(n.match(/(iPhone|iPad|iPod)/i)||n.match(/Android/i)||n.match(/Windows Phone/i)||n.match(/IEMobile/i)),u=!!n.match(/(iPhone|iPad|iPod)/i),l=!!n.match(/Android/i),c="MicroMessenger"==n.match(/MicroMessenger/i),d=c&&"wxwork"!=n.match(/wxwork/i),h=c&&"wxwork"!=n.match(/wxwork/i)&&"Mobile"==n.match(/Mobile/i),p=c&&"wxwork"!=n.match(/wxwork/i)&&"Mobile"!=n.match(/Mobile/i),f=c&&"wxwork"==n.match(/wxwork/i),m=c&&"wxwork"==n.match(/wxwork/i)&&"Mobile"==n.match(/Mobile/i),g=c&&"wxwork"==n.match(/wxwork/i)&&"Mobile"!=n.match(/Mobile/i)&&!o(),b={isChrome:s,isMobile:o,isPC:a,isIos:u,isAndroid:l,isWx:d,isWxMobile:h,isWxPc:p,isWxWork:f,isWxWorkMobile:m,isWxWorkPc:g,isFirefox:n.includes("Firefox"),isSafari:/Safari/.test(n)&&!/Chrome/.test(n),isMac:/macintosh|mac os x/i.test(n),isWindow:["win32","wow32","win64","wow64"].some((e=>n.toLowerCase().includes(e))),isWindow32:["win32","wow32"].some((e=>n.toLowerCase().includes(e))),isWindow64:["win64","wow64"].some((e=>n.toLowerCase().includes(e)))};function y(e){let t=e.split(",")[0].split(":")[1].split(";")[0],r=window.atob(e.split(",")[1]),i=new ArrayBuffer(r.length),n=new Uint8Array(i);for(let e=0,t=r.length;e<t;e++)n[e]=r.charCodeAt(e);return new Blob([n],{type:t})}function v(e){return new Promise((t=>{const r=new FileReader;r.readAsDataURL(e),r.onload=function(){t(this.result)}}))}function w(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const x=function(e,t,r=new Set){if(typeof e!=typeof t)return!1;if("object"==typeof e&&"object"==typeof t){if(r.has(e)&&r.has(t))return!0;r.add(e),r.add(t)}if(e===t||Number.isNaN(e)&&Number.isNaN(t))return!0;if("object"==typeof e){if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Map&&t instanceof Map){const i=Object.fromEntries(e.entries()),n=Object.fromEntries(t.entries());return x(i,n,r)}if(Array.isArray(e)&&Array.isArray(t)||"[object Object]"===Object.prototype.toString.call(e)&&"[object Object]"===Object.prototype.toString.call(t)){const i=Object.keys(e).sort(),n=Object.keys(t).sort();return i.length===n.length&&i.every(((i,s)=>i===n[s]&&x(e[i],t[i],r)))}}return!1},F=function(e,t){if(!(e=Number(e).toString()).includes("e")){if(e.includes(".")){if(void 0===t)return e;let r=e.split(".")[1].length;if(t>r)return e.padEnd(e.length+t-r,"0");const i=Math.round(e*Math.pow(10,r)/Math.pow(10,r-t))/Math.pow(10,t);return Number.isInteger(i)?i.toFixed(t):i}return Number(e).toFixed(t)}{let[r,i]=e.split("e");if(r.includes(".")){i-=r.split(".")[1].length,r=r.replace(".","")}if(i>0){const e=r+"0".repeat(i);return t?e+"."+"0".repeat(t):i>r.length||void 0===t?e:(e+"0".repeat(t)).slice(0,-1*t)}if(i<0){if(e="0."+r.padStart(-i,0),void 0===t)return e;const n=(Math.round(e*Math.pow(10,i)/Math.pow(10,i-t))/Math.pow(10,t)).toString();if(n.includes("e")){let[e,t]=n.split("e");if(e.includes(".")){t-=e.split(".")[1].length,e=e.replace(".","")}return"0."+e.padStart(-t,0)}return n}}return e},D=function(e,t,r,i){var n,s;if(void 0===t||void 0===r)throw new Error("The parameter are required !");const o=(null===(n=t.toString().split(".")[1])||void 0===n?void 0:n.length)||0,a=(null===(s=r.toString().split(".")[1])||void 0===s?void 0:s.length)||0,u=Math.pow(10,Math.max(o,a));if(![0,1,2,3].includes(e))throw new Error("type参数错误");return F(0===e?(t*u+r*u)/u:1===e?(t*u-r*u)/u:2===e?t*u*r*u/(u*u):t*u/(r*u),i)},A=function(e,t,r){if(Array.isArray(e)){if(!e.length)return F(0,r);let t=0;for(let i=0;i<e.length;i++)t=A(t,e[i],r);return t}return D(0,e,t,r)},E=function(e,t,r){if(Array.isArray(e)){if(!e.length)return F(0,r);let t=e[0];for(let i=1;i<e.length;i++)t=E(t,e[i],r);return t}return D(1,e,t,r)},S=function(e,t,r){return Array.isArray(e)&&e.length?e.reduce(((e,t)=>S(e,t,r)),1):D(2,e,t,r)},C=function(e,t,r){if(Array.isArray(e)&&e.length>=2&&e.every((e=>Number(e)>0))){let t=e[0];for(let i=1;i<e.length;i++)t=C(t,e[i],r);return t}if(!Array.isArray(e)&&e&&t)return D(3,e,t,r);throw new Error("The first two parameters are required")},N={isNoWord:e=>/^[^A-Za-z]*$/g.test(e),isCHNAndEN:e=>/^((?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])|(\d))+$/g.test(e),isPostcode:e=>/^(0[1-7]|1[0-356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[0-5]|8[013-6])\d{4}$/g.test(e),isWeChatNum:e=>/^[a-zA-Z][-_a-zA-Z0-9]{5,19}$/g.test(e),isColor16:e=>/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/g.test(e),isTrainNum:e=>/^[GCDZTSPKXLY1-9]\d{1,4}$/g.test(e),isHttpAndPort:e=>/^((ht|f)tps?:\/\/)?[\w-]+(\.[\w-]+)+:\d{1,5}\/?$/g.test(e),isRightWebsite:e=>/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/g.test(e),isCreditCode:e=>/^[0-9A-HJ-NPQRTUWXY]{2}\d{6}[0-9A-HJ-NPQRTUWXY]{10}$/g.test(e),isVersion:e=>/^\d+(?:\.\d+){2}$/g.test(e),isImageUrl:e=>/^https?:\/\/(.+\/)+.+(\.(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif))$/i.test(e),isChineseName:e=>/^(?:[\u4e00-\u9fa5·]{2,16})$/g.test(e),isEnglishName:e=>/(^[a-zA-Z]{1}[a-zA-Z\s]{0,20}[a-zA-Z]{1}$)/g.test(e),isLicensePlateNumberNER:e=>/[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}(([0-9]{5}[DF])|([DF][A-HJ-NP-Z0-9][0-9]{4}))$/g.test(e),isLicensePlateNumberNNER:e=>/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/g.test(e),isLicensePlateNumber:e=>/^(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}(?:(?:[0-9]{5}[DF])|(?:[DF](?:[A-HJ-NP-Z0-9])[0-9]{4})))|(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-Z]{1}[A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9 挂学警港澳]{1})$/g.test(e),isMPStrict:e=>/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-7|9])|(?:5[0-3|5-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1|8|9]))\d{8}$/g.test(e),isMPRelaxed:e=>/^(?:(?:\+|00)86)?1[3-9]\d{9}$/g.test(e),isEmail:e=>/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e),isLandlineTelephone:e=>/\d{3}-\d{8}|\d{4}-\d{7}/g.test(e),isPassport:e=>/(^[EeKkGgDdSsPpHh]\d{8}$)|(^(([Ee][a-fA-F])|([DdSsPp][Ee])|([Kk][Jj])|([Mm][Aa])|(1[45]))\d{7}$)/g.test(e),isChineseCharacter:e=>/^(?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])+$/g.test(e),isDecimal:e=>/^\d+\.\d+$/g.test(e),isInteger:e=>"number"==typeof e&&!isNaN(e)&&e%1==0,isNumberStr:e=>/^\d{1,}$/g.test(e),isQQNum:e=>/^[1-9][0-9]{4,10}$/g.test(e),isNumAndStr:e=>/^[A-Za-z0-9]+$/g.test(e),isEnglish:e=>/^[a-zA-Z]+$/g.test(e),isCapital:e=>/^[A-Z]+$/g.test(e),isLowercase:e=>/^[a-z]+$/g.test(e),isNumEnglishChinese:e=>/^[0-9a-zA-Z\u4e00-\u9fa5]+$/g.test(e),isContactNumber:e=>/^((\d{3,4}-\d{7,8})|(((13[0-9])|(14[5-9])|(16[5-6])|(15[0-3,5-9])|(17[0-8])|(18[0-9])|(19[1,8-9]))\d{8}))$/.test(e),isContainFace:e=>[/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g,/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,/[\uE000-\uF8FF]/g].some((t=>t.test(e)))};var T;!function(e){e[e.ADD=1]="ADD",e[e.GET=2]="GET",e[e.DELETE=3]="DELETE",e[e.UPDATE=4]="UPDATE",e[e.CLEAR=5]="CLEAR",e[e.CURSOR=6]="CURSOR",e[e.REFRESH=7]="REFRESH"}(T||(T={}));class O extends Error{constructor(e,t){super(e),this.code=t,this.name="IndexDBError"}}class M{constructor({dbName:e,dbVersion:t,storeName:r,keyPath:i,indexes:n=[],handleVersionUpgrade:s}){this.connectionTimeout=5e3,this.retryAttempts=3,this.cache=new Map,this.listeners=new Map,this.dbName=e,this.dbVersion=t,this.storeName=r,this.indexes=n,this.keyPath=i,this.db=null,this.handleVersionUpgrade=s,this.ensureConnection()}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,new Set),null===(r=this.listeners.get(e))||void 0===r||r.add(t)}emit(e,t){var r;null===(r=this.listeners.get(e))||void 0===r||r.forEach((e=>e(t)))}getWithCache(e){return w(this,void 0,void 0,(function*(){if(this.cache.has(e))return this.cache.get(e);const t=yield this.get(e);return this.cache.set(e,t),t}))}ensureConnection(){return w(this,void 0,void 0,(function*(){return this.db||(this.db=yield this.connectWithRetry()),this.db}))}connectWithRetry(){return w(this,arguments,void 0,(function*(e=0){try{return yield Promise.race([this.open(),new Promise(((e,t)=>setTimeout((()=>t(new Error("Connection timeout"))),this.connectionTimeout)))])}catch(t){if(e<this.retryAttempts)return console.warn(`Connection attempt ${e+1} failed, retrying...`),this.connectWithRetry(e+1);throw new O("Failed to connect to database",500)}}))}withTransaction(e,t){return w(this,void 0,void 0,(function*(){const r=(yield this.ensureConnection()).transaction([this.storeName],e),i=r.objectStore(this.storeName);return new Promise(((e,n)=>{const s=t(i);r.oncomplete=()=>e(s),r.onerror=()=>n(r.error),r.onabort=()=>n(r.error)}))}))}action(){return w(this,arguments,void 0,(function*(e={}){const{type:t=T.ADD,dbName:r=this.dbName,data:i={},keyPath:n=this.keyPath,cb:s=()=>{}}=e;try{const e=t===T.GET?"readonly":"readwrite";return yield this.withTransaction(e,(e=>w(this,void 0,void 0,(function*(){var o;switch(t){case T.ADD:return e.add(i);case T.GET:return new Promise((t=>{const r=e.get(n);r.onsuccess=()=>t(r.result)}));case T.DELETE:return e.delete(n);case T.UPDATE:return e.put(i);case T.CLEAR:return e.clear();case T.CURSOR:return new Promise((t=>{e.openCursor().onsuccess=e=>{const r=e.target.result;r&&(s(r),r.continue()),t(!0)}}));case T.REFRESH:return null===(o=this.db)||void 0===o||o.close(),this.db=yield this.open(r),this.db;default:throw new O("Invalid operation type",400)}}))))}catch(e){throw console.error("IndexDB operation failed:",e),new O(e.message||"Operation failed",e.code||500)}}))}open(e=this.dbName,t=this.dbVersion,r=this.keyPath){return new Promise(((i,n)=>{const s=window.indexedDB.open(e,t);s.onerror=e=>{const t=e.target.error;n(new O("Failed to open database",(null==t?void 0:t.code)||500))},s.onsuccess=e=>{const t=e.target.result;this.db=t,i(t)},s.onblocked=e=>{console.warn("Database upgrade blocked. Please close other tabs/windows."),n(new O("Database upgrade blocked",409))},s.onupgradeneeded=e=>{const s=e.target.result,o=e.oldVersion;try{if(!s.objectStoreNames.contains(this.storeName)){const e=s.createObjectStore(this.storeName,{keyPath:r});this.indexes.forEach((({name:t,keyPath:r,options:i={}})=>{e.indexNames.contains(t)||e.createIndex(t,r,i)})),o<t&&this.handleVersionUpgrade&&this.handleVersionUpgrade(s,o,t)}i(s)}catch(e){console.error("Database upgrade failed:",e),n(new O("Database upgrade failed",500))}}}))}add(e){return this.action({type:T.ADD,data:e})}get(e){return this.action({type:T.GET,keyPath:e})}del(e){return this.action({type:T.DELETE,keyPath:e})}put(e){return this.action({type:T.UPDATE,data:e})}clear(){return this.action({type:T.CLEAR})}refresh(){return this.action({type:T.REFRESH})}each(e){return this.action({type:T.CURSOR,cb:e})}delDB(e){return new Promise(((t,r)=>{const i=window.indexedDB.deleteDatabase(e);i.onsuccess=()=>t(),i.onerror=()=>r(new O("Failed to delete database",500))}))}bulkAdd(e){return w(this,void 0,void 0,(function*(){yield this.withTransaction("readwrite",(t=>w(this,void 0,void 0,(function*(){e.forEach((e=>t.add(e)))}))))}))}bulkGet(e){return w(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>this.get(e))))}))}getByIndex(e,t){return w(this,void 0,void 0,(function*(){return this.withTransaction("readonly",(r=>w(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{try{const s=r.index(e).getAll(t);s.onsuccess=()=>i(s.result),s.onerror=()=>n(new Error("Failed to query by index"))}catch(e){n(new Error("Index not found"))}}))}))))}))}rangeQuery(e,t){return w(this,arguments,void 0,(function*(e,t,r="next"){return this.withTransaction("readonly",(i=>w(this,void 0,void 0,(function*(){return new Promise(((n,s)=>{try{const o=i.index(e);let a;if(t instanceof IDBKeyRange)a=t;else{const{start:e,end:r,includes:i=!0}=t;void 0!==e&&void 0!==r?a=IDBKeyRange.bound(e,r,!i,!i):void 0!==e?a=IDBKeyRange.lowerBound(e,!i):void 0!==r&&(a=IDBKeyRange.upperBound(r,!i))}const u=[],l=o.openCursor(a,r);l.onsuccess=e=>{const t=e.target.result;t?(u.push(t.value),t.continue()):n(u)},l.onerror=()=>s(new Error("Range query failed"))}catch(e){s(new Error("Index not found or query failed"))}}))}))))}))}deleteStore(e){return w(this,void 0,void 0,(function*(){return this.dbVersion+=1,new Promise(((t,r)=>{this.closeConnection();const i=window.indexedDB.open(this.dbName,this.dbVersion);i.onupgradeneeded=t=>{const i=t.target.result;try{i.objectStoreNames.contains(e)&&i.deleteObjectStore(e)}catch(e){console.error("Failed to delete store:",e),r(new O("Failed to delete store",500))}},i.onsuccess=()=>{t()},i.onerror=e=>{const t=e.target.error;r(new O("Failed to delete store",(null==t?void 0:t.code)||500))}}))}))}closeConnection(){this.db&&(this.db.close(),this.db=null)}destroy(){this.closeConnection(),this.cache.clear(),this.listeners.clear()}}class j{constructor(){}set(...e){if(1===e.length){const t=e[0];if(j.isObj(t))for(let e in t)j.set(e,j.toStr(t[e]));else console.error("Local Error(1 parameter): there is only one parameter, it must be a pure object")}else if(2===e.length){const[t,r]=e;if(j.isObj(t)&&j.isNum(r))for(let e in t)j.set(e,j.toStr({value:t[e],createTime:Date.now(),expireTime:Date.now()+r,_ISLOCAL:1}));else j.isObj(t)?console.error("Local Error(2 parameter): When there are two parameters, if the first is an object, the second parameter must be the expiration time"):j.set(t,j.toStr(r))}else if(e.length>=3){const[t,r,i]=e;j.isStr(t)&&j.isNum(i)?j.set(t,j.toStr({value:r,createTime:Date.now(),expireTime:Date.now()+i,_ISLOCAL:1})):console.error("Local Error(3 parameter): The parameter is incorrect. The parameter format must be key-value-time")}}get(e,t){if(!Array.isArray(e)&&!j.hasOwn(e))return void 0===t?null:t;if(Array.isArray(e)&&(!e.some((e=>j.hasOwn(e)))||!e.length))return void 0===t?{}:t;if(Array.isArray(e)){return e.filter((e=>j.hasOwn(e))).reduce(((e,r)=>(e[r]=this.get(r,t),e)),{})}if(j.hasOwn(e)){let r=null;try{r=j.parse(e)}catch(t){r=j.get(e)}return j.isObj(r)&&r._ISLOCAL?r.expireTime&&r.expireTime<Date.now()?(j.remove(e),void 0===t?null:t):r.value:r}}del(e){if("string"==typeof e)j.remove(e);else if(Array.isArray(e))for(let t=0,r=e.length;t<r;t++)j.hasOwn(e[t])&&j.remove(e[t])}clear(){j.local.clear()}}j.local=window.localStorage,j.set=j.local.setItem.bind(j.local),j.get=j.local.getItem.bind(j.local),j.remove=j.local.removeItem.bind(j.local),j.parse=e=>JSON.parse(j.get(e)||"{}"),j.toStr=JSON.stringify,j.isStr=e=>"string"==typeof e,j.isObj=e=>"[object Object]"===Object.prototype.toString.call(e),j.isNum=e=>Number.isInteger(e)&&/^[+-]?\d+(\.\d+)?$/.test(String(e)),j.hasOwn=e=>Object.prototype.hasOwnProperty.call(j.local,e);const P=new j;class I{set(...e){if(Object.prototype.toString.call(e[0]))for(let t in e[0])I.storage.setItem(t,JSON.stringify(e[0][t]));else e.length>=2?I.storage.setItem(e[0],JSON.stringify(e[1])):console.error("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.")}get(e){if(Array.isArray(e))return(e=e.filter((e=>Object.prototype.hasOwnProperty.call(I.storage,e)))).reduce(((e,t)=>{let r=I.storage.getItem(t);try{r=JSON.parse(r)}catch(e){}return e[t]=r,e}),{});try{return JSON.parse(I.storage.getItem(e))}catch(t){return I.storage.getItem(e)}}del(e){I.storage.removeItem(e)}clear(){I.storage.clear()}}I.storage=window.sessionStorage;const $=new I;class k{constructor(e){this.a=0,this.a=e||0}round(e){let t=Number(this.a).toString(),r=t;if(t.includes("e")){let[i,n]=t.split("e");if(i.includes(".")){n-=i.split(".")[1].length,i=i.replace(".","")}if(n>0){const t=i+"0".repeat(n);r=e?t+"."+"0".repeat(e):n>i.length||void 0===e?t:(t+"0".repeat(e)).slice(0,-1*e)}else if(n<0)if(t="0."+i.padStart(-n,0),void 0===e)r=t;else{const i=(Math.round(t*Math.pow(10,n)/Math.pow(10,n-e))/Math.pow(10,e)).toString();if(i.includes("e")){let[e,t]=i.split("e");if(e.includes(".")){t-=e.split(".")[1].length,e=e.replace(".","")}r="0."+e.padStart(-t,0)}else r=i}}else if(t.includes(".")){if(void 0===e)return this.a=t,this;let i=t.split(".")[1].length;if(e>i)r=t.padEnd(t.length+e-i,"0");else if(void 0===e)r=t;else{const n=Math.round(t*Math.pow(10,i)/Math.pow(10,i-e))/Math.pow(10,e);r=Number.isInteger(n)?n.toFixed(e):n}}else r=Number(t).toFixed(e);return this.a=r,this}calc(e,t=0,r=0,i){var n,s;const o=(null===(n=t.toString().split(".")[1])||void 0===n?void 0:n.length)||0,a=(null===(s=r.toString().split(".")[1])||void 0===s?void 0:s.length)||0;let u=Math.pow(10,Math.max(o,a));if(![0,1,2,3].includes(e))throw new Error("type参数错误");const l=0===e?(t*u+r*u)/u:1===e?(t*u-r*u)/u:2===e?t*u*(r*u)/(u*u):t*u/(r*u);return this.a=l,this.round(i).toValue()}add(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.add(r,t),this.a)),r):r:this.a=this.calc(0,Number(r),Number(e),t),this}sub(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.sub(r,t),this.a)),r):r:this.a=this.calc(1,Number(r),Number(e),t),this}mul(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.mul(r,t),this.a)),r):r:this.a=this.calc(2,Number(r),Number(e),t),this}div(e,t){let r=this.a;return Array.isArray(e)?this.a=r?e.length?e.reduce(((e,r)=>(this.div(r,t),this.a)),r):r:0:this.a=r&&e?this.calc(3,Number(r),Number(e),t):0,this}toValue(){return this.a}}e.AsyncSource=class{constructor(){this.map=new Map,this.waitMap=new Map}has(e){return this.map.has(e)}get(e){return this.map.get(e)}set(e,t){this.map.set(e,t)}delete(e){this.map.delete(e)}wait(e,t,r){const i=this.waitMap.get(e)||[];i.push({resolve:t,reject:r}),this.waitMap.set(e,i)}dispatchWait(e,t,r){if(this.waitMap.has(e)){const i=this.waitMap.get(e);for(let e=0;e<i.length;e++){const n=i[e];r?n.reject(t):n.resolve(t)}}}getResult(e,t,r){const i=`${e}TaskName`,n=`${e}TaskErrName`;return this.has(e)||this.has(i)?new Promise(((t,r)=>{this.has(e)?t(this.get(e)):this.has(n)?r(this.get(n)):this.wait(e,t,r)})):(this.set(i,!0),t().then((t=>(this.set(e,t),this.dispatchWait(e,t),t))).catch((t=>{throw this.set(n,t),this.dispatchWait(e,t,!0),t})).finally((()=>{this.delete(i),r||setTimeout((()=>{this.delete(e),this.delete(n)}),1e3)})))}clear(){this.map.clear()}},e.Countdown=class{constructor(e){this.timer=null,this.ft=e.format||"dd天hh时mm分ss秒",this.list=e.list||[],this.key=e.timeKey,this.type=e.type,this.update()}update(){this.operation(1)}cancel(){this.operation(0)}calc(e){const t=e[this.key],r=(new Date(String(t).replace(/-/g,"/")).getTime()-+new Date)/1e3,i=Math.floor(r%86400/3600),n=i/60,s=r%60,o={d:Math.floor(r/86400)<=0?"00":Math.floor(r/86400),h:parseInt(String(i))<=0?"00":String(parseInt(String(i))).padStart(2,"0"),m:parseInt(String(n))<=0?"00":String(parseInt(String(n))).padStart(2,"0"),s:parseInt(String(s))<=0?"00":String(parseInt(String(s))).padStart(2,"0")};if(1==this.type)return this.ft.replace(/d|h{1,2}|m{1,2}|s{1,2}|S/g,(e=>"d"===e[0]||2===e.length?o[e[0]]:Number(o[e[0]])));e.d=o.d,e.h=o.h,e.m=o.m,e.s=o.s}operation(e){0==e?(clearInterval(this.timer),this.timer=null):1==e&&(this.timer&&clearInterval(this.timer),this.timer=setInterval((()=>{for(let e=0;e<this.list.length;e++)1===this.type?this.list[e].end=this.calc(this.list[e]):this.calc(this.list[e])}),1e3))}},e.Emitter=class{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,...t){this.events[e]&&this.events[e].forEach((e=>{e(...t)}))}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}once(e,t){this.events[e]||(this.events[e]=[]);const r=(...i)=>{t(...i),this.off(e,r)};this.events[e].push(r)}},e.ImageHotSpot=class{constructor(e){this.container=null,this.canvas=null,this.isInit=!1,this.handleMouseDownFunc=e=>{},this.scale=1,this.hotImgWidth=0,this.hotImgHeight=0,this.options=e,this.init()}init(){if(this.container="string"==typeof this.options.el?document.querySelector(this.options.el):this.options.el,!this.container)throw new Error(`${this.options.el||""} container is not found`);this.options.addMode=this.options.addMode||"default",this.initDefaultProps(),this.initSquarePos(),!0!==this.options.customUpload&&this.resetInit()}initDefaultProps(){var e,t,r,i,n,s,o,a,u,l,c,d,h,p,f,m,g,b,y,v,w,x,F,D,A,E,S;const{size:C,width:N="8px",height:T="8px",borderColor:O="#1447FF",backgroundColor:M="#1447FF"}=(null===(e=this.options)||void 0===e?void 0:e.handle)||{},j=`position: absolute;border: 1px solid ${O};background-color: ${M};box-sizing: border-box;width: ${C||N};height: ${C||T};`;this.defaultProps={canvas:{className:"hot-container",cssText:"width: 100%; height: 100%; position: relative; border: 1px dashed #ccc; box-sizing: border-box;"},container:Object.assign({className:"hot-container",cssText:"width: 100%; height: 100%; position: relative; border: 1px dashed #ccc; box-sizing: border-box;"},(null===(r=null===(t=this.options)||void 0===t?void 0:t.style)||void 0===r?void 0:r.container)||{}),square:Object.assign({className:"hot-square",cssText:`width: 88px; height: 88px; background-color: rgba(20, 71, 255, 0.2); border: 1px dashed ${O}; cursor: move; position: absolute; left: 0px; top: 0px; opacity: 1; box-sizing: border-box;`},(null===(n=null===(i=this.options)||void 0===i?void 0:i.style)||void 0===n?void 0:n.square)||{}),content:Object.assign({className:"hot-content",cssText:"display:none"},(null===(o=null===(s=this.options)||void 0===s?void 0:s.style)||void 0===o?void 0:o.content)||{}),lt:Object.assign({className:"lt",cssText:`${j}cursor: nw-resize;top: -4px;left: -4px;`},(null===(u=null===(a=this.options)||void 0===a?void 0:a.style)||void 0===u?void 0:u.lt)||{}),lm:Object.assign({className:"lm",cssText:`${j}cursor: e-resize;top: 50%;left: -4px;transform: translateY(-50%);`},(null===(c=null===(l=this.options)||void 0===l?void 0:l.style)||void 0===c?void 0:c.lm)||{}),lb:Object.assign({className:"lb",cssText:`${j}cursor: ne-resize;bottom: -4px;left: -4px;`},(null===(h=null===(d=this.options)||void 0===d?void 0:d.style)||void 0===h?void 0:h.lb)||{}),bm:Object.assign({className:"bm",cssText:`${j}cursor: n-resize;bottom: -4px;left: 50%;transform: translateX(-50%);`},(null===(f=null===(p=this.options)||void 0===p?void 0:p.style)||void 0===f?void 0:f.bm)||{}),br:Object.assign({className:"br",cssText:`${j}cursor: se-resize;bottom: -4px;right: -4px;`},(null===(g=null===(m=this.options)||void 0===m?void 0:m.style)||void 0===g?void 0:g.br)||{}),rm:Object.assign({className:"rm",cssText:`${j}cursor: e-resize;top: 50%;right: -4px;transform: translateY(-50%);`},(null===(y=null===(b=this.options)||void 0===b?void 0:b.style)||void 0===y?void 0:y.rm)||{}),tm:Object.assign({className:"tm",cssText:`${j}cursor: n-resize;top: -4px;left: 50%;transform: translateX(-50%);`},(null===(w=null===(v=this.options)||void 0===v?void 0:v.style)||void 0===w?void 0:w.tm)||{}),rt:Object.assign({className:"rt",cssText:`${j}cursor: ne-resize;top: -4px;right: -4px;`},(null===(F=null===(x=this.options)||void 0===x?void 0:x.style)||void 0===F?void 0:F.rt)||{}),seq:Object.assign({className:"hot-seq",cssText:"min-width: 14px; min-height: 14px; text-align: center; color: #fff; line-height: 14px; position: absolute; top: 0px; left: 0px; background-color: red; font-size: 10px;z-index:-1;cursor:default"},(null===(A=null===(D=this.options)||void 0===D?void 0:D.style)||void 0===A?void 0:A.seq)||{}),del:Object.assign({className:"hot-del",cssText:"width: 16px; height: 16px; position: absolute; right: -20px; top: -20px; z-index: 2; cursor: pointer;"},(null===(S=null===(E=this.options)||void 0===E?void 0:E.style)||void 0===S?void 0:S.del)||{})}}initSquarePos(){this.squarePos=Object.assign({x:"0px",y:"0px",w:"80px",h:"80px"},this.options.squarePos||{})}resetInit(){this.isInit=!0,this.generateContainer(),this.handleMouseDownFunc=this.handleMouseDown.bind(this),this.canvas.addEventListener("mousedown",this.handleMouseDownFunc)}generateContainer(){var e;const t=this.createElement("div",Object.assign({},this.defaultProps.canvas));null===(e=this.container)||void 0===e||e.appendChild(t),this.canvas=t}addHotArea({x:e=this.squarePos.x,y:t=this.squarePos.y,w:r=this.squarePos.w,h:i=this.squarePos.h}={},n){var s,o;if("default"===this.options.addMode||n){if(!this.canvas)return null===(o=null===(s=this.options)||void 0===s?void 0:s.beforeAdd)||void 0===o||o.call(s),Promise.reject(new Error("Please initialize the instance first"));if(!this.container)return Promise.reject(new Error("Please initialize the instance first"));const n=this.container.querySelectorAll(".hot-square").length+1,a=this.createHotSquare(n,{style:{left:e,top:t,width:r,height:i}});return this.canvas.appendChild(a),Promise.resolve({index:n,square:a})}return Promise.reject(new Error("options addMode is not default"))}createHotSquare(e,t){return this.createElement("div",Object.assign(Object.assign({},this.defaultProps.square),t),[this.createElement("div",Object.assign({},this.defaultProps.content),this.createElement("div",Object.assign({},this.defaultProps.lt)),this.createElement("div",Object.assign({},this.defaultProps.lm)),this.createElement("div",Object.assign({},this.defaultProps.lb)),this.createElement("div",Object.assign({},this.defaultProps.bm)),this.createElement("div",Object.assign({},this.defaultProps.br)),this.createElement("div",Object.assign({},this.defaultProps.rm)),this.createElement("div",Object.assign({},this.defaultProps.rt)),this.createElement("div",Object.assign({},this.defaultProps.tm)),this.createElement("div",Object.assign({},this.defaultProps.del),this.createElement("div",{className:"lines",cssText:" width: 16px;height: 16px;position: relative;cursor: pointer;border-radius: 50%;background: #ff4b4b;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);display: flex;align-items: center;justify-content: center;"},[this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(45deg);"}),this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(-45deg);"})]))),this.createElement("div",Object.assign({},this.defaultProps.seq),e)])}createElement(e,...t){const r="object"!=typeof t[0]||Array.isArray(t[0])?{}:t.shift();let i=t.flat(1/0);const n=document.createElement(e);((e,t)=>{t.cssText&&(e.style.cssText=t.cssText,delete t.cssText),t.style&&("string"==typeof t.style?e.style.cssText=t.style:"object"==typeof t.style&&Object.assign(e.style,t.style),delete t.style)})(n,r);for(const[e,t]of Object.entries(r))if("className"!==e||"string"!=typeof t)if("htmlFor"!==e||"string"!=typeof t)if(/^on[A-Z]/.test(e)&&"function"==typeof t){const r=e.slice(2).toLowerCase();n.addEventListener(r,t)}else"style"!==e?"boolean"!=typeof t?n.setAttribute(e,t):t?n.setAttribute(e,""):n.removeAttribute(e):"object"==typeof t?Object.assign(n.style,t):"string"==typeof t&&(n.style.cssText=t);else n.setAttribute("for",t);else n.className=t;return i=i.flat(1/0).filter((e=>null!=e&&!1!==e)).map((e=>"string"==typeof e||"number"==typeof e?document.createTextNode(String(e)):e)),i.forEach((e=>{e instanceof Node?n.appendChild(e):console.warn("Invalid child element:",e)})),n}delHotArea(e){const t=e.closest(".hot-square");if(t){const e=1*t.querySelector(".hot-seq").innerText,r=()=>{t.remove(),this.resetHotSeq(e)};"function"==typeof this.options.beforeDel?this.options.beforeDel(e,t,r):r()}}resetHotSeq(e){if(!this.container)return;this.container.querySelectorAll(".hot-square").forEach((t=>{const r=t.querySelector(".hot-seq");if(r){const t=Number(r.innerText);t>e&&(r.innerText=String(t-1))}}))}handleMouseDown(e){if(e.preventDefault(),!this.canvas)return;const{target:t}=e,r=t.className,i=t.closest(".hot-del");if(i)return this.delHotArea(i);let n=null;if(["lt","lm","lb","bm","br","rm","rt","tm","hot-square"].includes(r)){const i="hot-square"===r?t:t.closest(".hot-square"),s=this.canvas.querySelector(".hot-active");s&&s.parentElement!==i&&(s.classList.remove("hot-active"),s.style.display="none"),n=i.querySelector(".hot-content"),n&&!n.classList.contains("hot-active")&&(n.classList.add("hot-active"),n.style.display="block",i.style.zIndex=String(this.getMaxZIndex()+1)),this.startDrag(e,i,r,n)}else if("hot-container"===r&&"manual"===this.options.addMode){const t=this.canvas.getBoundingClientRect(),r=t.left,i=t.top,n=e.clientX-r,s=e.clientY-i,o=this.createElement("div",{className:"hot-line",style:{left:n+"px",top:s+"px",width:"0px",height:"0px",border:"1px solid red",boxSizing:"border-box",position:"absolute"}});this.canvas.appendChild(o);let a=0,u=0;document.onmousemove=e=>{const{clientX:t,clientY:l}=e,c=t-r-n,d=l-i-s;o.style.left=n+"px",o.style.top=s+"px",o.style.width=c+"px",o.style.height=d+"px",a=c,u=d},document.onmouseup=e=>{var t,r,i;o&&(null===(t=this.canvas)||void 0===t||t.removeChild(o));const l=()=>this.addHotArea({x:n+"px",y:s+"px",w:a+"px",h:u+"px"},!0);a>16&&u>16&&(null===(i=null===(r=this.options)||void 0===r?void 0:r.manualAdd)||void 0===i?void 0:i.call(r,l))&&l(),document.onmousemove=null,document.onmouseup=null}}}startDrag(e,t,r,i){var n,s;const{clientX:o,clientY:a}=e,u=t.offsetWidth,l=t.offsetHeight,c=parseInt(t.style.left)||0,d=parseInt(t.style.top)||0,h=(null===(n=this.canvas)||void 0===n?void 0:n.offsetWidth)||0,p=(null===(s=this.canvas)||void 0===s?void 0:s.offsetHeight)||0,f=h-u,m=p-l;document.onmousemove=e=>{this.handleMouseMove(e,r,t,o,a,u,l,c,d,f,m,20,h,p)},document.onmouseup=()=>{var e,t;null===(t=null===(e=this.options)||void 0===e?void 0:e.overlapCallback)||void 0===t||t.call(e,this.areElementsOverlapping(this.canvas)),i&&(i.style.opacity="1"),document.onmousemove=null,document.onmouseup=null}}handleMouseMove(e,t,r,i,n,s,o,a,u,l,c,d,h,p){const f=e.clientX-i,m=e.clientY-n;switch(t){case"hot-square":this.moveSquare(r,a,u,f,m,l,c);break;case"lt":this.resizeLT(r,s,o,a,u,f,m,d,h,p);break;case"lb":this.resizeLB(r,s,o,a,u,f,m,d,h,p);break;case"rt":this.resizeRT(r,s,o,a,u,f,m,d,h,p);break;case"br":this.resizeBR(r,s,o,a,u,f,m,d,h,p);break;case"lm":this.resizeLM(r,s,a,f,d,h);break;case"rm":this.resizeRM(r,s,a,f,d,h);break;case"tm":this.resizeTM(r,o,u,m,d,p);break;case"bm":this.resizeBM(r,o,u,m,d,p)}}moveSquare(e,t,r,i,n,s,o){const a=Math.max(0,Math.min(t+i,s)),u=Math.max(0,Math.min(r+n,o));e.style.left=`${a}px`,e.style.top=`${u}px`}resizeLT(e,t,r,i,n,s,o,a,u,l){let c=t+(s=-s),d=i-s,h=r+(o=-o),p=n-o;c<a&&(c=a,d=i+t-a),d<0&&(d=0,c=t+i),d+c>u&&(c=u-d),h<a&&(h=a,p=n+r-a),p<0&&(p=0,h=r+n),p+h>l&&(h=l-p),e.style.width=`${c}px`,e.style.height=`${h}px`,e.style.left=`${d}px`,e.style.top=`${p}px`}resizeLB(e,t,r,i,n,s,o,a,u,l){let c=t-s,d=i+s,h=r+o;c<a&&(c=a,d=i+(t-a)),d<0&&(d=0,c=t+i),d+c>u&&(c=u-d),h<a&&(h=a),n+h>l&&(h=l-n),e.style.width=`${c}px`,e.style.left=`${d}px`,e.style.height=`${h}px`}resizeRT(e,t,r,i,n,s,o,a,u,l){let c=t+s,d=r+(o=-o),h=n-o;c<a&&(c=a),i+c>u&&(c=u-i),d<a&&(d=a,h=n+r-a),h<0&&(h=0,d=r+n),h+d>l&&(d=l-h),e.style.width=`${c}px`,e.style.height=`${d}px`,e.style.top=`${h}px`}resizeBR(e,t,r,i,n,s,o,a,u,l){let c=t+s,d=r+o;c<a&&(c=a),i+c>u&&(c=u-i),d<a&&(d=a),n+d>l&&(d=l-n),e.style.width=`${c}px`,e.style.height=`${d}px`}resizeLM(e,t,r,i,n,s){let o=t-i,a=r+i;o<n&&(o=n,a=r+(t-n)),a<0&&(a=0,o=t+r),a+o>s&&(o=s-a),e.style.width=`${o}px`,e.style.left=`${a}px`}resizeRM(e,t,r,i,n,s){let o=t+i;o<n&&(o=n),r+o>s&&(o=s-r),e.style.width=`${o}px`}resizeTM(e,t,r,i,n,s){let o=t+(i=-i),a=r-i;o<n&&(o=n,a=r+t-n),a<0&&(a=0,o=t+r),a+o>s&&(o=s-a),e.style.height=`${o}px`,e.style.top=`${a}px`}resizeBM(e,t,r,i,n,s){let o=t+i;o<n&&(o=n),r+o>s&&(o=s-r),e.style.height=`${o}px`}uploadHotImg(e){return new Promise(((t,r)=>{var i;const n=new Image;n.src=e,n.style.cssText="position:absolute;left:0;top:0;opacity:0",null===(i=this.container)||void 0===i||i.appendChild(n),n.onload=()=>{this.scaleCalc(n.offsetWidth,n.offsetHeight,e,t),n.remove()},n.onerror=()=>{n.remove(),r(new Error("Image load error"))}}))}scaleCalc(e,t,r,i){var n,s;if(this.isInit||this.resetInit(),!this.container||!this.canvas)return;const{offsetWidth:o,offsetHeight:a}=this.container,u=e/t,l=o/a;let c;c="auto"===this.options.scaleMode&&e<o&&t<a?1:u>l?o/e:a/t,this.canvas.style.cssText=`\n        position: absolute;\n        width: ${e*c}px;\n        height: ${t*c}px;\n        background-image: url(${r});\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        background-size: contain;\n        background-repeat: no-repeat;\n        background-position: center;\n        box-sizing: border-box;\n        border: 1px dashed #ccc;\n      `;const d=(null===(s=null===(n=this.options)||void 0===n?void 0:n.style)||void 0===s?void 0:s.canvas)||{};Object.keys(d).forEach((e=>{this.canvas&&(this.canvas.style[e]=d[e])})),this.scale=c,this.hotImgWidth=e*c,this.hotImgHeight=t*c,i({w:this.hotImgWidth,h:this.hotImgHeight,scale:this.scale})}destroy(){var e,t,r;null===(e=this.container)||void 0===e||e.querySelectorAll(".hot-square").forEach((e=>e.remove())),null===(t=this.canvas)||void 0===t||t.remove(),this.canvas=null,this.isInit=!1,null===(r=this.container)||void 0===r||r.removeEventListener("mousedown",this.handleMouseDownFunc)}getMaxZIndex(){var e;const t=null===(e=this.container)||void 0===e?void 0:e.querySelectorAll(".hot-square");return(null==t?void 0:t.length)?Math.max(...Array.from(t).map((e=>parseInt(getComputedStyle(e).zIndex)||1))):1}areElementsOverlapping(e=this.canvas){if(!e)return!1;const t=e.querySelectorAll(".hot-square"),r=t.length;for(let e=0;e<r;e++){const i=t[e].getBoundingClientRect();for(let n=e+1;n<r;n++){const e=t[n].getBoundingClientRect();if(!(e.left>i.right||e.right<i.left||e.top>i.bottom||e.bottom<i.top))return!0}}return!1}getHotAreaData(e="array"){const t=this.container.querySelectorAll(".hot-square");return Array.from(t).reduce(((t,r)=>{const i=r.querySelector(".hot-seq");if(!i)return t;const n=parseInt(i.innerText)-1,s=parseFloat(r.style.left||"0"),o=parseFloat(r.style.top||"0");if("array"===e){const e=t;return n<e.length?e[n]={x:s,y:o,w:r.offsetWidth,h:r.offsetHeight,index:n}:console.warn(`Index ${n} exceeds array length`),e}{const e=t;return e[n]={x:s,y:o,w:r.offsetWidth,h:r.offsetHeight,index:n},e}}),"array"===e?[]:{})}},e.add=A,e.addStyleCss=function(e,t){const r=[...document.styleSheets].find((t=>{var r;return(null===(r=t.ownerNode)||void 0===r?void 0:r.id)===e}));if(r){for(let e=0;e<t.length;e++)r.insertRule(t[e]);return r}{const e=document.createElement("style");return e.id="add_style_css_"+Date.now(),document.body.appendChild(e),e.onload=()=>{const r=[...document.styleSheets].find((t=>{var r;return(null===(r=t.ownerNode)||void 0===r?void 0:r.id)===e.id}));for(let e=0;e<t.length;e++)r.insertRule(t[e])},e}},e.arrayGroup=function(e,t){if(0===e.length)return[];const r=[];let i=0;for(let n=1,s=e.length;n<s;n++){const s=e[n-1],o=e[n];s[t]!==o[t]&&(r.push(e.slice(i,n)),i=n)}return r.push(e.slice(i)),r},e.arrayRestore=function(e,t,r,n=!1){return n||(e=i(e)),e.splice(t,0,e.splice(r,1)[0]),e},e.arrayToTree=function e(t,r=null,i="id",n="pid",s="children"){return t.filter((e=>e[n]===r)).map((r=>Object.assign(Object.assign({},r),{[s]:e(t,r[i],i,n,s)})))},e.attrFilter=function(e,t={}){return Object.keys(e).reduce(((r,i)=>(t.isEmptyZero&&0===e[i]||t.isEmptyObject&&"[object Object]"===Object.prototype.toString.call(e[i])&&!Object.keys(e[i]).length||t.isEmptyArray&&Array.isArray(e[i])&&!e[i].length||t.isNull&&null===e[i]||t.isEmptyString&&""===e[i]||!0===t.isFalse&&!1===e[i]||(r[i]=e[i]),r)),{})},e.base64ToBlob=y,e.base64ToFile=function(e,t){let r=e.split(","),i=r[0].match(/:(.*?);/)[1],n=atob(r[1]),s=n.length,o=new Uint8Array(s);for(;s--;)o[s]=n.charCodeAt(s);return new File([o],t,{type:i})},e.bfs=r,e.blobToBase64=function(e){return new Promise(((t,r)=>{const i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){r(e)},i.readAsDataURL(e)}))},e.blobToFile=function(e,t){return new File([e],t,{type:e.type,lastModified:Date.now()})},e.browser=b,e.bufferFileDownload=function(e,t){const r=new Blob([e],{type:"charset=utf-8"}),i=document.createElement("a"),n=window.URL.createObjectURL(r);i.href=n,i.download=t;const s=document.getElementsByTagName("body")[0];s.appendChild(i),i.click(),s.removeChild(i),window.URL.revokeObjectURL(n)},e.bytesFormat=function(e){if(0===e)return"0 B";if(!e)return"";let t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},e.calc=D,e.copyText=function(e){const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},e.debounce=function(e,t,r){let i=null;return function(...n){if(r){const r=!i;i=setTimeout((()=>{i=null}),t),r&&e.apply(this,n)}else i&&clearTimeout(i),i=setTimeout((()=>{e.apply(this,n)}),t)}},e.deepClone=i,e.delBy=function(e,t,r=!1){if(!Array.isArray(e))throw new Error("First argument must be an array.");if("function"!=typeof t&&!Array.isArray(t)&&("object"!=typeof t||null===t))throw new Error("Second argument must be a function, array, or object.");if("boolean"!=typeof r)throw new Error("Third argument must be a boolean.");const n=r?e:i(e);for(let e=n.length-1;e>=0;e--)if("function"==typeof t)t(n[e])&&n.splice(e,1);else if(Array.isArray(t))t.indexOf(n[e])>-1&&n.splice(e,1);else if(n[e]===t)n.splice(e,1);else if("Object"===Object.prototype.toString.call(t).slice(8,-1)){let r=n[e];for(let i in t)Array.isArray(t[i])?t[i].indexOf(r[i])>-1&&n.splice(e,1):t[i]===r[i]&&n.splice(e,1)}return n},e.difference=function(e,t,r){return r?e.filter((e=>!t.some((t=>e[r]===t[r])))):e.filter((e=>!t.includes(e)))},e.div=C,e.downloadByBase64=function(e,t="default"){const r=document.createElement("a");if(r.style.display="none",document.body.appendChild(r),r.download=t,r.href=e,document.createEvent){const e=document.createEvent("MouseEvents");e.initEvent("click",!0,!1),r.dispatchEvent(e)}else document.createEventObject?r.fireEvent("onclick"):"function"==typeof r.onclick&&r.onclick();document.body.removeChild(r)},e.fileToBase64=v,e.fileToBlob=function(e){return w(this,void 0,void 0,(function*(){return y(yield v(e))}))},e.filterEmoji=function(e){return e=(e=(e=e.replace(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g,"")).replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,"")).replace(/[\uE000-\uF8FF]/g,"")},e.findIndexs=function(e,t){const r=[];for(let i=0;i<e.length;i++)t(e[i])&&r.push(i);return r},e.fmtNum=function(e,t,r,i){if(void 0===e||null==e)return"";let n=F(e,r)+"";if(!/^[+-]?\d+(\.\d+)?$/.test(String(n)))return"";if(i)return Number(n);if(!t)return n;const[s,o=""]=n.split(".");return s.replace(/(?=(?!\b)(\d{3})+$)/g,",")+(o?"."+o:o)},e.formData=function(e){return Object.keys(e).reduce(((t,r)=>(t.append(r,e[r]),t)),new FormData)},e.getMaxZIndex=function(){const e=document.querySelectorAll("*");return Math.max(...Array.from(e).map((e=>parseInt(getComputedStyle(e).zIndex)||1)))},e.getQuery=function(e=window.location.href){try{const t={},r=new URL(e);for(const[e,i]of new URLSearchParams(r.search).entries())t[decodeURIComponent(e)]=decodeURIComponent(i);return t}catch(t){console.error("Error parsing URL:",t);try{return e.includes("?")?e.split("?")[1].split("&").map((e=>e.split("="))).reduce(((e,[t,r])=>(e[decodeURIComponent(t)]=decodeURIComponent(r),e)),{}):{}}catch(e){return{}}}},e.getRepeat=function(e=[]){return e.reduce(((e,t,r,i)=>{t=Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{});const n=JSON.stringify(t);return e.countMap[n]?e.countMap[n]++:e.countMap[n]=1,r===i.length-1&&(Object.keys(e.countMap).forEach((t=>e[e.countMap[t]>1?"repeatArr":"notRepeatArr"].push(JSON.parse(t)))),delete e.countMap),e}),{repeatArr:[],notRepeatArr:[],countMap:{}})},e.getScrollDirection=function e(t=window){const r=(t=t===window?window:"string"==typeof t?document.querySelector(t):t)===window?t.scrollX:t.scrollLeft,i=t===window?t.scrollY:t.scrollTop;if(void 0===(t=t===window?e:t).oldScrollLeft&&void 0===t.oldScrollTop&&i&&r)return t.oldScrollLeft=0,t.oldScrollTop=0,t.oldScrollLeft=r,t.oldScrollTop=i,{x:!0,y:!0};void 0===t.oldScrollLeft&&(t.oldScrollLeft=0),void 0===t.oldScrollTop&&(t.oldScrollTop=0);const n=t.oldScrollTop!==i;return t.oldScrollLeft=r,t.oldScrollTop=i,{x:!n,y:n}},e.groupBy=function(e,t){return e.reduce(((e,r,i,n)=>(e[r[t]]?e[r[t]].push(r):e[r[t]]=[r],i===n.length-1?Object.values(e):e)),{})},e.guid=function(){return Array.from({length:8},((e,t)=>(65536*(1+Math.random())|0).toString(16).substring(1)+([1,2,3,4].includes(t)?"-":""))).join("")},e.indexdb=e=>new M(e),e.intersection=function(e,t,r){return r?e.filter((e=>t.some((t=>e[r]===t[r])))):e.filter((e=>t.includes(e)))},e.isEqual=x,e.isRepeat=function(e,r){const i=e.length;if(0===i||1===i)return!!r&&{repeatIndex:-1,repeatItem:null,isRepeat:!1};try{for(let t=0;t<i;t++)for(let n=t+1;n<i;n++)if(x(e[t],e[n]))return!r||{repeatIndex:t,repeatItem:e[t],isRepeat:!0};return!!r&&{repeatIndex:-1,repeatItem:null,isRepeat:!1}}catch(n){return r?{repeatIndex:-1,repeatItem:null,isRepeat:i!==t(e).length}:i!==t(e).length}},e.isValidNum=function(e,t){return(t?/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/:/^[+-]?\d+(\.\d+)?$/).test(String(e))},e.local=P,e.make=function(e,t,r){return e.reduce(((e,i)=>[...e,{[i[t]]:i[r]}]),[])},e.moneyToChinese=function(e){let t,r,i,n=String(Math.round(100*e)),s="",o="零壹贰叁肆伍陆柒捌玖",a="万仟佰拾亿仟佰拾万仟佰拾元角分",u=n.length,l=0;if(u>15)return alert("超出计算范围"),"";if(0==e)return s="零元整",s;-1!=n.indexOf("-")?(a=a.substr(a.length-u+1,u-1),n=n.substr(1,u-1),u=n.length,s="负"):a=a.substr(a.length-u,u);for(let e=0;e<u;e++)i=parseInt(n.substr(e,1),10),e!=u-3&&e!=u-7&&e!=u-11&&e!=u-15?0==i?(t="",r="",l+=1):0!=i&&0!=l?(t="零"+o.substr(i,1),r=a.substr(e,1),l=0):(t=o.substr(i,1),r=a.substr(e,1),l=0):(0!=i&&0!=l?(t="零"+o.substr(i,1),r=a.substr(e,1),l=0):0!=i&&0==l?(t=o.substr(i,1),r=a.substr(e,1),l=0):0==i&&l>=3?(t="",r="",l+=1):(t="",r=a.substr(e,1),l+=1),(e==u-11||e==u-3)&&(r=a.substr(e,1))),s=s+t+r;return 0==i&&(s+="整"),s},e.mul=S,e.num=function(e){return new k(e)},e.pick=function(e,t){return e.reduce(((e,r)=>[...e,t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:r[t]})),{})]),[])},e.pluckDeep=e=>(t,r)=>{try{return e.split(".").reduce(((e,t)=>null==e?void 0:e[t]),t)||r}catch(e){return r}},e.queryNode=function(e,t,{idAlias:r="id",childrenAlias:n="children"}){var s;e=i(e);const o=Array.isArray(e)?e:[e];for(;o.length;){const e=o.shift();if(e[r]===t)return e;null===(s=null==e?void 0:e[n])||void 0===s||s.forEach((e=>o.push(e)))}},e.queryPath=function e(t,r,i="children",n=[]){var s;if(!t)return[];t=Array.isArray(t)?t:[t];for(const o of t){if(n.push(o),r(o))return n;if(null===(s=o[i])||void 0===s?void 0:s.length){const t=e(o[i],r,i,n);if(t.length)return t}n.pop()}return[]},e.range=function(e,t,r=0,i){if(void 0===i&&0===r)return Array.from({length:t-e+1},((t,r)=>r+e));if(i)return Array.from({length:r||0},(()=>Math.floor(Math.random()*(t-e+1))+e));{const i=Array.from({length:t-e+1},((t,r)=>r+e)),n=r>i.length?i.length:r,s=[];for(;s.length!=n;){const e=i[Math.floor(Math.random()*i.length)];!s.includes(e)&&s.push(e)}return s}},e.rangeStep=function(e,t,r){return Array.from({length:(t-e)/r+1},((t,i)=>e+i*r))},e.reg=N,e.round=F,e.selectTextByElement=function(e){const t="string"==typeof e?document.querySelector(e):e;if(document.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){const e=window.getSelection(),r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}},e.session=$,e.sub=E,e.sumBigNumber=function(e,t){let r="",i=0;for(e=e.split(""),t=t.split("");e.length||t.length||i;)i+=~~e.pop()+~~t.pop(),r=i%10+r,i=i>9;return r.replace(/^0+/,"")},e.throttle=function(e,t,r){let i,n=0;r||(r={});let s=function(...s){let o=+new Date;!1!==r.leading||n||(n=o),o-n>t?(i&&(clearTimeout(i),i=null),e.apply(this,s),n=o):i||!1===r.trailing||(i=setTimeout((()=>{n=+new Date,i=null,e.apply(this,s)}),t))};return s.cancel=function(){i&&clearTimeout(i),i=void 0,n=0},s},e.treeToArray=function e(t,r="children"){return(Array.isArray(t)?t:[t]).reduce(((t,i)=>[...t,i,...e(i[r]||[],r)]),[])},e.trigger=function(e,t){const r=document.createEvent("Events");r.initEvent(t,!0,!0),t in e?(e[t](),["blur","scroll","select"].includes(t)&&e.dispatchEvent(r)):e.dispatchEvent(r)},e.union=function(e,t,r){return r?[...e,...t.filter((t=>e.find((e=>e[r]!==t[r]))))]:Array.from(new Set([...e,...t]))},e.unique=t,e.urlSerialize=function(e,t={}){return Object.keys(t).reduce(((r,i)=>r+(r===e?"?":"&")+`${i}=${encodeURIComponent(t[i])}`),e)},e.urlTmtFmt=function(e,t={},r){let i=/\{(\w+)\}/g.test(e)?e.replace(/\{(\w+)\}/g,((e,r)=>{let i=t[r];return delete t[r],i})):e;return r&&Object.keys(t).length?Object.keys(t).reduce(((e,r)=>e+(e===i?"?":"&")+`${r}=${t[r]}`),i):i},Object.defineProperty(e,"__esModule",{value:!0})}));
