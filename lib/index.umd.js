!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rutils={})}(this,(function(e){"use strict";const t=function(e,t){if(!Array.isArray(e))throw new Error("传入的第一个参数必须为数组类型");if(void 0!==t&&"string"!=typeof t)throw new Error("传入的第二个参数必须为字符串类型");const r=new Map;return e.filter((e=>{const s=t?e[t]:JSON.stringify(e);return!r.has(s)&&(r.set(s,!0),!0)}))},r=function(e,t){const s=Array.isArray(e)?[...e]:[e],i=t.children||"children";for(;s.length;){const e=s.shift();t.cb?t.cb(e,r):t&&t(e,r),e&&e[i]&&e[i].length&&e[i].forEach((e=>s.push(e)))}};const s=function(e){const t=(e,t)=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase()===t,r=[],s=[],i=e=>{if(null===e)return null;if("object"!=typeof e&&"function"!=typeof e)return e;let n,o;t(e,"array")?n=[]:t(e,"regexp")?(n=new e.constructor(e.source,/\w*$/.exec(e)),e.lastIndex&&(n.lastIndex=e.lastIndex)):t(e,"date")?n=new Date(e.getTime()):t(e,"function")?(o=Object.getPrototypeOf(e),n=function(e){const t=new Function("return "+e.toString())();t.prototype=Object.create(e.prototype);for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(e)):(o=Object.getPrototypeOf(e),n=Object.create(o));const a=r.indexOf(e);if(-1!==a)return s[a];r.push(e),s.push(n);for(const t in e)n[t]=i(e[t]);return n};return i(e)};const i=window.navigator.userAgent,n=!!i.match(/Chrome/i),o=!!(i.match(/(iPhone|iPad|iPod)/i)||i.match(/Android/i)||i.match(/Windows Phone/i)||i.match(/IEMobile/i)),a=!(i.match(/(iPhone|iPad|iPod)/i)||i.match(/Android/i)||i.match(/Windows Phone/i)||i.match(/IEMobile/i)),u=!!i.match(/(iPhone|iPad|iPod)/i),l=!!i.match(/Android/i),c="MicroMessenger"==i.match(/MicroMessenger/i),d=c&&"wxwork"!=i.match(/wxwork/i),h=c&&"wxwork"!=i.match(/wxwork/i)&&"Mobile"==i.match(/Mobile/i),p=c&&"wxwork"!=i.match(/wxwork/i)&&"Mobile"!=i.match(/Mobile/i),f=c&&"wxwork"==i.match(/wxwork/i),m=c&&"wxwork"==i.match(/wxwork/i)&&"Mobile"==i.match(/Mobile/i),g=c&&"wxwork"==i.match(/wxwork/i)&&"Mobile"!=i.match(/Mobile/i)&&!o(),y={isChrome:n,isMobile:o,isPC:a,isIos:u,isAndroid:l,isWx:d,isWxMobile:h,isWxPc:p,isWxWork:f,isWxWorkMobile:m,isWxWorkPc:g,isFirefox:i.includes("Firefox"),isSafari:/Safari/.test(i)&&!/Chrome/.test(i),isMac:/macintosh|mac os x/i.test(i),isWindow:["win32","wow32","win64","wow64"].some((e=>i.toLowerCase().includes(e))),isWindow32:["win32","wow32"].some((e=>i.toLowerCase().includes(e))),isWindow64:["win64","wow64"].some((e=>i.toLowerCase().includes(e)))};function b(e){let t=e.split(",")[0].split(":")[1].split(";")[0],r=window.atob(e.split(",")[1]),s=new ArrayBuffer(r.length),i=new Uint8Array(s);for(let e=0,t=r.length;e<t;e++)i[e]=r.charCodeAt(e);return new Blob([i],{type:t})}function v(e){return new Promise((t=>{const r=new FileReader;r.readAsDataURL(e),r.onload=function(){t(this.result)}}))}function w(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{u(s.next(e))}catch(e){n(e)}}function a(e){try{u(s.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const x=function(e,t,r=new Set){if(typeof e!=typeof t)return!1;if("object"==typeof e&&"object"==typeof t){if(r.has(e)&&r.has(t))return!0;r.add(e),r.add(t)}if(e===t||Number.isNaN(e)&&Number.isNaN(t))return!0;if("object"==typeof e){if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Map&&t instanceof Map){const s=Object.fromEntries(e.entries()),i=Object.fromEntries(t.entries());return x(s,i,r)}if(Array.isArray(e)&&Array.isArray(t)||"[object Object]"===Object.prototype.toString.call(e)&&"[object Object]"===Object.prototype.toString.call(t)){const s=Object.keys(e).sort(),i=Object.keys(t).sort();return s.length===i.length&&s.every(((s,n)=>s===i[n]&&x(e[s],t[s],r)))}}return!1},F=function(e,t){if(!(e=Number(e).toString()).includes("e")){if(e.includes(".")){if(void 0===t)return e;let r=e.split(".")[1].length;if(t>r)return e.padEnd(e.length+t-r,"0");const s=Math.round(e*Math.pow(10,r)/Math.pow(10,r-t))/Math.pow(10,t);return Number.isInteger(s)?s.toFixed(t):s}return Number(e).toFixed(t)}{let[r,s]=e.split("e");if(r.includes(".")){s-=r.split(".")[1].length,r=r.replace(".","")}if(s>0){const e=r+"0".repeat(s);return t?e+"."+"0".repeat(t):s>r.length||void 0===t?e:(e+"0".repeat(t)).slice(0,-1*t)}if(s<0){if(e="0."+r.padStart(-s,0),void 0===t)return e;const i=(Math.round(e*Math.pow(10,s)/Math.pow(10,s-t))/Math.pow(10,t)).toString();if(i.includes("e")){let[e,t]=i.split("e");if(e.includes(".")){t-=e.split(".")[1].length,e=e.replace(".","")}return"0."+e.padStart(-t,0)}return i}}return e},D=function(e,t,r,s){var i,n;if(void 0===t||void 0===r)throw new Error("The parameter are required !");const o=(null===(i=t.toString().split(".")[1])||void 0===i?void 0:i.length)||0,a=(null===(n=r.toString().split(".")[1])||void 0===n?void 0:n.length)||0,u=Math.pow(10,Math.max(o,a));if(![0,1,2,3].includes(e))throw new Error("type参数错误");return F(0===e?(t*u+r*u)/u:1===e?(t*u-r*u)/u:2===e?t*u*r*u/(u*u):t*u/(r*u),s)},A=function(e,t,r){if(Array.isArray(e)){if(!e.length)return F(0,r);let t=0;for(let s=0;s<e.length;s++)t=A(t,e[s],r);return t}return D(0,e,t,r)},E=function(e,t,r){if(Array.isArray(e)){if(!e.length)return F(0,r);let t=e[0];for(let s=1;s<e.length;s++)t=E(t,e[s],r);return t}return D(1,e,t,r)},S=function(e,t,r){return Array.isArray(e)&&e.length?e.reduce(((e,t)=>S(e,t,r)),1):D(2,e,t,r)},C=function(e,t,r){if(0===e||"0"===e)return 0;if(0===t||"0"===t)throw new Error("除数不能为0");if(Array.isArray(e)&&e.length>=2&&e.every((e=>Number(e)>0))){let t=e[0];for(let s=1;s<e.length;s++)t=C(t,e[s],r);return t}if(!Array.isArray(e)&&e&&t)return D(3,e,t,r);throw new Error("The first two parameters are required")},T={isNoWord:e=>/^[^A-Za-z]*$/g.test(e),isCHNAndEN:e=>/^((?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])|(\d))+$/g.test(e),isPostcode:e=>/^(0[1-7]|1[0-356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[0-5]|8[013-6])\d{4}$/g.test(e),isWeChatNum:e=>/^[a-zA-Z][-_a-zA-Z0-9]{5,19}$/g.test(e),isColor16:e=>/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/g.test(e),isTrainNum:e=>/^[GCDZTSPKXLY1-9]\d{1,4}$/g.test(e),isHttpAndPort:e=>/^((ht|f)tps?:\/\/)?[\w-]+(\.[\w-]+)+:\d{1,5}\/?$/g.test(e),isRightWebsite:e=>/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/g.test(e),isCreditCode:e=>/^[0-9A-HJ-NPQRTUWXY]{2}\d{6}[0-9A-HJ-NPQRTUWXY]{10}$/g.test(e),isVersion:e=>/^\d+(?:\.\d+){2}$/g.test(e),isImageUrl:e=>/^https?:\/\/(.+\/)+.+(\.(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif))$/i.test(e),isChineseName:e=>/^(?:[\u4e00-\u9fa5·]{2,16})$/g.test(e),isEnglishName:e=>/(^[a-zA-Z]{1}[a-zA-Z\s]{0,20}[a-zA-Z]{1}$)/g.test(e),isLicensePlateNumberNER:e=>/[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}(([0-9]{5}[DF])|([DF][A-HJ-NP-Z0-9][0-9]{4}))$/g.test(e),isLicensePlateNumberNNER:e=>/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/g.test(e),isLicensePlateNumber:e=>/^(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-HJ-NP-Z]{1}(?:(?:[0-9]{5}[DF])|(?:[DF](?:[A-HJ-NP-Z0-9])[0-9]{4})))|(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]{1}[A-Z]{1}[A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9 挂学警港澳]{1})$/g.test(e),isMPStrict:e=>/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-7|9])|(?:5[0-3|5-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1|8|9]))\d{8}$/g.test(e),isMPRelaxed:e=>/^(?:(?:\+|00)86)?1[3-9]\d{9}$/g.test(e),isEmail:e=>/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e),isLandlineTelephone:e=>/\d{3}-\d{8}|\d{4}-\d{7}/g.test(e),isPassport:e=>/(^[EeKkGgDdSsPpHh]\d{8}$)|(^(([Ee][a-fA-F])|([DdSsPp][Ee])|([Kk][Jj])|([Mm][Aa])|(1[45]))\d{7}$)/g.test(e),isChineseCharacter:e=>/^(?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])+$/g.test(e),isDecimal:e=>/^\d+\.\d+$/g.test(e),isInteger:e=>"number"==typeof e&&!isNaN(e)&&e%1==0,isNumberStr:e=>/^\d{1,}$/g.test(e),isQQNum:e=>/^[1-9][0-9]{4,10}$/g.test(e),isNumAndStr:e=>/^[A-Za-z0-9]+$/g.test(e),isEnglish:e=>/^[a-zA-Z]+$/g.test(e),isCapital:e=>/^[A-Z]+$/g.test(e),isLowercase:e=>/^[a-z]+$/g.test(e),isNumEnglishChinese:e=>/^[0-9a-zA-Z\u4e00-\u9fa5]+$/g.test(e),isContactNumber:e=>/^((\d{3,4}-\d{7,8})|(((13[0-9])|(14[5-9])|(16[5-6])|(15[0-3,5-9])|(17[0-8])|(18[0-9])|(19[1,8-9]))\d{8}))$/.test(e),isContainFace:e=>[/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g,/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,/[\uE000-\uF8FF]/g].some((t=>t.test(e)))};var N;!function(e){e[e.ADD=1]="ADD",e[e.GET=2]="GET",e[e.DELETE=3]="DELETE",e[e.UPDATE=4]="UPDATE",e[e.CLEAR=5]="CLEAR",e[e.CURSOR=6]="CURSOR",e[e.REFRESH=7]="REFRESH"}(N||(N={}));class P extends Error{constructor(e,t){super(e),this.code=t,this.name="IndexDBError"}}class j{constructor({dbName:e,dbVersion:t,storeName:r,keyPath:s,indexes:i=[],handleVersionUpgrade:n}){this.connectionTimeout=5e3,this.retryAttempts=3,this.cache=new Map,this.listeners=new Map,this.dbName=e,this.dbVersion=t,this.storeName=r,this.indexes=i,this.keyPath=s,this.db=null,this.handleVersionUpgrade=n,this.ensureConnection()}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,new Set),null===(r=this.listeners.get(e))||void 0===r||r.add(t)}emit(e,t){var r;null===(r=this.listeners.get(e))||void 0===r||r.forEach((e=>e(t)))}getWithCache(e){return w(this,void 0,void 0,(function*(){if(this.cache.has(e))return this.cache.get(e);const t=yield this.get(e);return this.cache.set(e,t),t}))}ensureConnection(){return w(this,void 0,void 0,(function*(){return this.db||(this.db=yield this.connectWithRetry()),this.db}))}connectWithRetry(){return w(this,arguments,void 0,(function*(e=0){try{return yield Promise.race([this.open(),new Promise(((e,t)=>setTimeout((()=>t(new Error("Connection timeout"))),this.connectionTimeout)))])}catch(t){if(e<this.retryAttempts)return console.warn(`Connection attempt ${e+1} failed, retrying...`),this.connectWithRetry(e+1);throw new P("Failed to connect to database",500)}}))}withTransaction(e,t){return w(this,void 0,void 0,(function*(){const r=(yield this.ensureConnection()).transaction([this.storeName],e),s=r.objectStore(this.storeName);return new Promise(((e,i)=>w(this,void 0,void 0,(function*(){let n;r.oncomplete=()=>e(n),r.onerror=()=>i(r.error);try{n=yield t(s)}catch(e){i(e)}}))))}))}open(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbName,this.dbVersion);r.onerror=e=>{const r=e.target.error;t(new P("Failed to open database",(null==r?void 0:r.code)||500))},r.onsuccess=t=>{const r=t.target.result;this.db=r,e(r)},r.onblocked=e=>{console.warn("Database upgrade blocked. Please close other tabs/windows."),t(new P("Database upgrade blocked",409))},r.onupgradeneeded=e=>{const r=e.target.result,s=e.oldVersion,i=e.newVersion||this.dbVersion,n=e.target.transaction;try{let e;e=r.objectStoreNames.contains(this.storeName)?n.objectStore(this.storeName):r.createObjectStore(this.storeName,{keyPath:this.keyPath}),this.indexes.forEach((({name:t,keyPath:r,options:s={}})=>{if(e.indexNames.contains(t)){const i=e.index(t);i.keyPath===r&&i.unique===s.unique&&i.multiEntry===s.multiEntry||(e.deleteIndex(t),e.createIndex(t,r,s))}else e.createIndex(t,r,s)})),this.handleVersionUpgrade&&this.handleVersionUpgrade(r,s,i,n)}catch(e){console.error("Database upgrade failed:",e),t(new P("Database upgrade failed",500))}}}))}action(){return w(this,arguments,void 0,(function*(e={}){const{type:t=N.ADD,data:r={},key:s,cb:i=()=>{}}=e;try{const e=t===N.GET?"readonly":"readwrite";return yield this.withTransaction(e,(e=>w(this,void 0,void 0,(function*(){switch(t){case N.ADD:return new Promise(((t,s)=>{const i=e.add(r);i.onsuccess=()=>{const e=Array.isArray(this.keyPath)?this.keyPath.map((e=>r[e])).join("|"):r[this.keyPath];this.cache.set(e,r),this.emit("add",r),t(i.result)},i.onerror=()=>s(i.error)}));case N.GET:return new Promise(((t,r)=>{const i=e.get(s);i.onsuccess=()=>{const e=String(s);this.cache.set(e,i.result),t(i.result)},i.onerror=()=>r(i.error)}));case N.DELETE:return new Promise(((t,r)=>{const i=e.delete(s);i.onsuccess=()=>{this.cache.delete(String(s)),this.emit("delete",s),t(void 0)},i.onerror=()=>r(i.error)}));case N.UPDATE:return new Promise(((t,s)=>{const i=e.put(r);i.onsuccess=()=>{const e=Array.isArray(this.keyPath)?this.keyPath.map((e=>r[e])).join("|"):r[this.keyPath];this.cache.set(e,r),this.emit("update",r),t(i.result)},i.onerror=()=>s(i.error)}));case N.CLEAR:return new Promise(((t,r)=>{const s=e.clear();s.onsuccess=()=>{this.cache.clear(),this.emit("clear"),t(void 0)},s.onerror=()=>r(s.error)}));case N.CURSOR:return new Promise(((t,r)=>{const s=e.openCursor();s.onsuccess=e=>{const r=e.target.result;r?(i(r),r.continue()):t(void 0)},s.onerror=()=>r(s.error)}));case N.REFRESH:return this.closeConnection(),this.db=yield this.open(),this.db;default:throw new P("Invalid operation type",400)}}))))}catch(e){throw console.error("IndexDB operation failed:",e),new P(e.message||"Operation failed",e.code||500)}}))}add(e){return this.action({type:N.ADD,data:e})}get(e){return this.action({type:N.GET,key:e})}del(e){return this.action({type:N.DELETE,key:e})}put(e){return this.action({type:N.UPDATE,data:e})}clear(){return this.action({type:N.CLEAR})}refresh(){return this.action({type:N.REFRESH})}each(e){return this.action({type:N.CURSOR,cb:e})}delDB(e){return new Promise(((t,r)=>{const s=window.indexedDB.deleteDatabase(e);s.onsuccess=()=>t(),s.onerror=()=>r(new P("Failed to delete database",500))}))}bulkAdd(e){return w(this,void 0,void 0,(function*(){yield this.withTransaction("readwrite",(t=>w(this,void 0,void 0,(function*(){yield Promise.all(e.map((e=>new Promise(((r,s)=>{const i=t.add(e);i.onsuccess=()=>r(i.result),i.onerror=()=>s(i.error)})))))}))))}))}bulkGet(e){return w(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>this.get(e))))}))}getByIndex(e,t){return w(this,void 0,void 0,(function*(){return this.withTransaction("readonly",(r=>w(this,void 0,void 0,(function*(){return new Promise(((s,i)=>{try{const n=r.index(e).getAll(t);n.onsuccess=()=>s(n.result),n.onerror=()=>i(new Error("Failed to query by index"))}catch(e){i(new Error("Index not found"))}}))}))))}))}rangeQuery(e,t){return w(this,arguments,void 0,(function*(e,t,r="next"){return this.withTransaction("readonly",(s=>w(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{try{const o=s.index(e);let a;if(t instanceof IDBKeyRange)a=t;else{const{start:e,end:r,includes:s=!0}=t;void 0!==e&&void 0!==r?a=IDBKeyRange.bound(e,r,!s,!s):void 0!==e?a=IDBKeyRange.lowerBound(e,!s):void 0!==r&&(a=IDBKeyRange.upperBound(r,!s))}const u=[],l=o.openCursor(a,r);l.onsuccess=e=>{const t=e.target.result;t?(u.push(t.value),t.continue()):i(u)},l.onerror=()=>n(new Error("Range query failed"))}catch(e){n(new Error("Index not found or query failed"))}}))}))))}))}deleteStore(e){return w(this,void 0,void 0,(function*(){this.closeConnection();const t=(yield this.getCurrentDBVersion())+1;return new Promise(((r,s)=>{this.closeConnection();const i=window.indexedDB.open(this.dbName,t);i.onupgradeneeded=t=>{const r=t.target.result;r.objectStoreNames.contains(e)&&r.deleteObjectStore(e)},i.onsuccess=e=>{e.target.result.close(),r()},i.onerror=()=>s(new Error("删除失败"))}))}))}getCurrentDBVersion(){return w(this,void 0,void 0,(function*(){return new Promise((e=>{const t=indexedDB.open(this.dbName);t.onsuccess=()=>{const r=t.result,s=r.version;r.close(),e(s)}}))}))}closeConnection(){this.db&&(this.db.close(),this.db=null)}destroy(){this.closeConnection(),this.cache.clear(),this.listeners.clear()}}class O{constructor(){}set(...e){if(1===e.length){const t=e[0];if(O.isObj(t))for(let e in t)O.set(e,O.toStr(t[e]));else console.error("Local Error(1 parameter): there is only one parameter, it must be a pure object")}else if(2===e.length){const[t,r]=e;if(O.isObj(t)&&O.isNum(r))for(let e in t)O.set(e,O.toStr({value:t[e],createTime:Date.now(),expireTime:Date.now()+r,_ISLOCAL:1}));else O.isObj(t)?console.error("Local Error(2 parameter): When there are two parameters, if the first is an object, the second parameter must be the expiration time"):O.set(t,O.toStr(r))}else if(e.length>=3){const[t,r,s]=e;O.isStr(t)&&O.isNum(s)?O.set(t,O.toStr({value:r,createTime:Date.now(),expireTime:Date.now()+s,_ISLOCAL:1})):console.error("Local Error(3 parameter): The parameter is incorrect. The parameter format must be key-value-time")}}get(e,t){if(!Array.isArray(e)&&!O.hasOwn(e))return void 0===t?null:t;if(Array.isArray(e)&&(!e.some((e=>O.hasOwn(e)))||!e.length))return void 0===t?{}:t;if(Array.isArray(e)){return e.filter((e=>O.hasOwn(e))).reduce(((e,r)=>(e[r]=this.get(r,t),e)),{})}if(O.hasOwn(e)){let r=null;try{r=O.parse(e)}catch(t){r=O.get(e)}return O.isObj(r)&&r._ISLOCAL?r.expireTime&&r.expireTime<Date.now()?(O.remove(e),void 0===t?null:t):r.value:r}}del(e){if("string"==typeof e)O.remove(e);else if(Array.isArray(e))for(let t=0,r=e.length;t<r;t++)O.hasOwn(e[t])&&O.remove(e[t])}clear(){O.local.clear()}}O.local=window.localStorage,O.set=O.local.setItem.bind(O.local),O.get=O.local.getItem.bind(O.local),O.remove=O.local.removeItem.bind(O.local),O.parse=e=>JSON.parse(O.get(e)||"{}"),O.toStr=JSON.stringify,O.isStr=e=>"string"==typeof e,O.isObj=e=>"[object Object]"===Object.prototype.toString.call(e),O.isNum=e=>Number.isInteger(e)&&/^[+-]?\d+(\.\d+)?$/.test(String(e)),O.hasOwn=e=>Object.prototype.hasOwnProperty.call(O.local,e);const M=new O;class I{set(...e){if(Object.prototype.toString.call(e[0]))for(let t in e[0])I.storage.setItem(t,JSON.stringify(e[0][t]));else e.length>=2?I.storage.setItem(e[0],JSON.stringify(e[1])):console.error("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.")}get(e){if(Array.isArray(e))return(e=e.filter((e=>Object.prototype.hasOwnProperty.call(I.storage,e)))).reduce(((e,t)=>{let r=I.storage.getItem(t);try{r=JSON.parse(r)}catch(e){}return e[t]=r,e}),{});try{return JSON.parse(I.storage.getItem(e))}catch(t){return I.storage.getItem(e)}}del(e){I.storage.removeItem(e)}clear(){I.storage.clear()}}I.storage=window.sessionStorage;const k=new I;class ${constructor(e){this.a=0,this.a=e||0}round(e){let t=Number(this.a).toString(),r=t;if(t.includes("e")){let[s,i]=t.split("e");if(s.includes(".")){i-=s.split(".")[1].length,s=s.replace(".","")}if(i>0){const t=s+"0".repeat(i);r=e?t+"."+"0".repeat(e):i>s.length||void 0===e?t:(t+"0".repeat(e)).slice(0,-1*e)}else if(i<0)if(t="0."+s.padStart(-i,0),void 0===e)r=t;else{const s=(Math.round(t*Math.pow(10,i)/Math.pow(10,i-e))/Math.pow(10,e)).toString();if(s.includes("e")){let[e,t]=s.split("e");if(e.includes(".")){t-=e.split(".")[1].length,e=e.replace(".","")}r="0."+e.padStart(-t,0)}else r=s}}else if(t.includes(".")){if(void 0===e)return this.a=t,this;let s=t.split(".")[1].length;if(e>s)r=t.padEnd(t.length+e-s,"0");else if(void 0===e)r=t;else{const i=Math.round(t*Math.pow(10,s)/Math.pow(10,s-e))/Math.pow(10,e);r=Number.isInteger(i)?i.toFixed(e):i}}else r=Number(t).toFixed(e);return this.a=r,this}calc(e,t=0,r=0,s){var i,n;const o=(null===(i=t.toString().split(".")[1])||void 0===i?void 0:i.length)||0,a=(null===(n=r.toString().split(".")[1])||void 0===n?void 0:n.length)||0;let u=Math.pow(10,Math.max(o,a));if(![0,1,2,3].includes(e))throw new Error("type参数错误");const l=0===e?(t*u+r*u)/u:1===e?(t*u-r*u)/u:2===e?t*u*(r*u)/(u*u):t*u/(r*u);return this.a=l,this.round(s).toValue()}add(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.add(r,t),this.a)),r):r:this.a=this.calc(0,Number(r),Number(e),t),this}sub(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.sub(r,t),this.a)),r):r:this.a=this.calc(1,Number(r),Number(e),t),this}mul(e,t){let r=this.a;return Array.isArray(e)?this.a=e.length?e.reduce(((e,r)=>(this.mul(r,t),this.a)),r):r:this.a=this.calc(2,Number(r),Number(e),t),this}div(e,t){let r=this.a;return Array.isArray(e)?this.a=r?e.length?e.reduce(((e,r)=>(this.div(r,t),this.a)),r):r:0:this.a=r&&e?this.calc(3,Number(r),Number(e),t):0,this}toValue(){return this.a}}e.AsyncSource=class{constructor(){this.map=new Map,this.waitMap=new Map}has(e){return this.map.has(e)}get(e){return this.map.get(e)}set(e,t){this.map.set(e,t)}delete(e){this.map.delete(e)}wait(e,t,r){const s=this.waitMap.get(e)||[];s.push({resolve:t,reject:r}),this.waitMap.set(e,s)}dispatchWait(e,t,r){if(this.waitMap.has(e)){const s=this.waitMap.get(e);for(let e=0;e<s.length;e++){const i=s[e];r?i.reject(t):i.resolve(t)}}}getResult(e,t,r){const s=`${e}TaskName`,i=`${e}TaskErrName`;return this.has(e)||this.has(s)?new Promise(((t,r)=>{this.has(e)?t(this.get(e)):this.has(i)?r(this.get(i)):this.wait(e,t,r)})):(this.set(s,!0),t().then((t=>(this.set(e,t),this.dispatchWait(e,t),t))).catch((t=>{throw this.set(i,t),this.dispatchWait(e,t,!0),t})).finally((()=>{this.delete(s),r||setTimeout((()=>{this.delete(e),this.delete(i)}),1e3)})))}clear(){this.map.clear()}},e.Countdown=class{constructor(e){this.timer=null,this.ft=e.format||"dd天hh时mm分ss秒",this.list=e.list||[],this.key=e.timeKey,this.type=e.type,this.update()}update(){this.operation(1)}cancel(){this.operation(0)}calc(e){const t=e[this.key],r=(new Date(String(t).replace(/-/g,"/")).getTime()-+new Date)/1e3,s=Math.floor(r%86400/3600),i=s/60,n=r%60,o={d:Math.floor(r/86400)<=0?"00":Math.floor(r/86400),h:parseInt(String(s))<=0?"00":String(parseInt(String(s))).padStart(2,"0"),m:parseInt(String(i))<=0?"00":String(parseInt(String(i))).padStart(2,"0"),s:parseInt(String(n))<=0?"00":String(parseInt(String(n))).padStart(2,"0")};if(1==this.type)return this.ft.replace(/d|h{1,2}|m{1,2}|s{1,2}|S/g,(e=>"d"===e[0]||2===e.length?o[e[0]]:Number(o[e[0]])));e.d=o.d,e.h=o.h,e.m=o.m,e.s=o.s}operation(e){0==e?(clearInterval(this.timer),this.timer=null):1==e&&(this.timer&&clearInterval(this.timer),this.timer=setInterval((()=>{for(let e=0;e<this.list.length;e++)1===this.type?this.list[e].end=this.calc(this.list[e]):this.calc(this.list[e])}),1e3))}},e.Emitter=class{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,...t){this.events[e]&&this.events[e].forEach((e=>{e(...t)}))}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}once(e,t){this.events[e]||(this.events[e]=[]);const r=(...s)=>{t(...s),this.off(e,r)};this.events[e].push(r)}},e.ImageHotSpot=class{constructor(e){this.container=null,this.canvas=null,this.isInit=!1,this.handleMouseDownFunc=e=>{},this.scale=1,this.hotImgWidth=0,this.hotImgHeight=0,this.options=e,this.init()}init(){if(this.container="string"==typeof this.options.el?document.querySelector(this.options.el):this.options.el,!this.container)throw new Error(`${this.options.el||""} container is not found`);this.options.addMode=this.options.addMode||"default",this.initDefaultProps(),this.initSquarePos(),!0!==this.options.customUpload&&this.resetInit()}initDefaultProps(){var e,t,r,s,i,n,o,a,u,l,c,d,h,p,f,m,g,y,b,v,w,x,F,D,A,E,S,C,T;const{size:N,width:P="8px",height:j="8px",borderColor:O="#1447FF",backgroundColor:M="#1447FF"}=(null===(e=this.options)||void 0===e?void 0:e.handle)||{},I=`position: absolute;border: 1px solid ${O};background-color: ${M};box-sizing: border-box;width: ${N||P};height: ${N||j};`;this.defaultProps={canvas:Object.assign({className:"hot-container",cssText:"width: 100%; height: 100%; position: relative; border: 1px dashed #ccc; box-sizing: border-box;"},(null===(r=null===(t=this.options)||void 0===t?void 0:t.style)||void 0===r?void 0:r.canvas)||{}),container:Object.assign({className:"hot-container",cssText:"width: 100%; height: 100%; position: relative;"},(null===(i=null===(s=this.options)||void 0===s?void 0:s.style)||void 0===i?void 0:i.container)||{}),square:Object.assign({className:"hot-square",cssText:`width: 88px; height: 88px; background-color: rgba(20, 71, 255, 0.2); border: 1px dashed ${O}; cursor: move; position: absolute; left: 0px; top: 0px; opacity: 1; box-sizing: border-box;`},(null===(o=null===(n=this.options)||void 0===n?void 0:n.style)||void 0===o?void 0:o.square)||{}),content:Object.assign({className:"hot-content",cssText:"display:none"},(null===(u=null===(a=this.options)||void 0===a?void 0:a.style)||void 0===u?void 0:u.content)||{}),lt:Object.assign({className:"lt",cssText:`${I}cursor: nw-resize;top: -4px;left: -4px;`},(null===(c=null===(l=this.options)||void 0===l?void 0:l.style)||void 0===c?void 0:c.lt)||{}),lm:Object.assign({className:"lm",cssText:`${I}cursor: e-resize;top: 50%;left: -4px;transform: translateY(-50%);`},(null===(h=null===(d=this.options)||void 0===d?void 0:d.style)||void 0===h?void 0:h.lm)||{}),lb:Object.assign({className:"lb",cssText:`${I}cursor: ne-resize;bottom: -4px;left: -4px;`},(null===(f=null===(p=this.options)||void 0===p?void 0:p.style)||void 0===f?void 0:f.lb)||{}),bm:Object.assign({className:"bm",cssText:`${I}cursor: n-resize;bottom: -4px;left: 50%;transform: translateX(-50%);`},(null===(g=null===(m=this.options)||void 0===m?void 0:m.style)||void 0===g?void 0:g.bm)||{}),br:Object.assign({className:"br",cssText:`${I}cursor: se-resize;bottom: -4px;right: -4px;`},(null===(b=null===(y=this.options)||void 0===y?void 0:y.style)||void 0===b?void 0:b.br)||{}),rm:Object.assign({className:"rm",cssText:`${I}cursor: e-resize;top: 50%;right: -4px;transform: translateY(-50%);`},(null===(w=null===(v=this.options)||void 0===v?void 0:v.style)||void 0===w?void 0:w.rm)||{}),tm:Object.assign({className:"tm",cssText:`${I}cursor: n-resize;top: -4px;left: 50%;transform: translateX(-50%);`},(null===(F=null===(x=this.options)||void 0===x?void 0:x.style)||void 0===F?void 0:F.tm)||{}),rt:Object.assign({className:"rt",cssText:`${I}cursor: ne-resize;top: -4px;right: -4px;`},(null===(A=null===(D=this.options)||void 0===D?void 0:D.style)||void 0===A?void 0:A.rt)||{}),seq:Object.assign({className:"hot-seq",cssText:"min-width: 14px; min-height: 14px; text-align: center; color: #fff; line-height: 14px; position: absolute; top: 0px; left: 0px; background-color: red; font-size: 10px;cursor:default"},(null===(S=null===(E=this.options)||void 0===E?void 0:E.style)||void 0===S?void 0:S.seq)||{}),del:Object.assign({className:"hot-del",cssText:"width: 16px; height: 16px; position: absolute; right: -20px; top: -20px; z-index: 2; cursor: pointer;"},(null===(T=null===(C=this.options)||void 0===C?void 0:C.style)||void 0===T?void 0:T.del)||{})}}initSquarePos(){this.squarePos=Object.assign({x:0,y:0,w:80,h:80},this.options.squarePos||{})}resetInit(){this.isInit=!0,this.generateContainer(),this.handleMouseDownFunc=this.handleMouseDown.bind(this),this.canvas.addEventListener("mousedown",this.handleMouseDownFunc),setTimeout((()=>{var e,t;null===(t=null===(e=this.options)||void 0===e?void 0:e.afterInit)||void 0===t||t.call(e)}))}generateContainer(){var e;const t=this.createElement("div",Object.assign({},this.defaultProps.canvas));null===(e=this.container)||void 0===e||e.appendChild(t),this.canvas=t}isNum(e){const t=String(e);return"symbol"!=typeof e&&(!isNaN(parseFloat(t))&&isFinite(Number(t)))}addHotArea({x:e=this.squarePos.x,y:t=this.squarePos.y,w:r=this.squarePos.w,h:s=this.squarePos.h}={},i){var n,o,a,u;if(null===(o=null===(n=this.options)||void 0===n?void 0:n.beforeAdd)||void 0===o?void 0:o.call(n,this.hasBackgroundImage()))return Promise.reject(new Error("beforeAdd return false"));if(!this.canvas||!this.container)return Promise.reject(new Error("Please initialize the instance first"));if("default"===this.options.addMode||i){if(this.isNum(this.options.upperLimit)&&this.container.querySelectorAll(".hot-square").length>=Number(this.options.upperLimit))return Promise.reject(new Error("upperLimit is exceeded"));const i=this.container.querySelectorAll(".hot-square").length+1,n=this.createHotSquare(i,{style:{left:parseFloat(e)+"px",top:parseFloat(t)+"px",width:parseFloat(r)+"px",height:parseFloat(s)+"px"}});return this.canvas.appendChild(n),null===(u=null===(a=this.options)||void 0===a?void 0:a.afterAdd)||void 0===u||u.call(a,{seq:i,square:n}),Promise.resolve({index:i-1,square:n})}return Promise.reject(new Error("options addMode is not default"))}createHotSquare(e,t){return this.createElement("div",Object.assign(Object.assign({},this.defaultProps.square),t),[this.createElement("div",Object.assign({},this.defaultProps.content),this.createElement("div",Object.assign({},this.defaultProps.lt)),this.createElement("div",Object.assign({},this.defaultProps.lm)),this.createElement("div",Object.assign({},this.defaultProps.lb)),this.createElement("div",Object.assign({},this.defaultProps.bm)),this.createElement("div",Object.assign({},this.defaultProps.br)),this.createElement("div",Object.assign({},this.defaultProps.rm)),this.createElement("div",Object.assign({},this.defaultProps.rt)),this.createElement("div",Object.assign({},this.defaultProps.tm)),this.createElement("div",Object.assign({},this.defaultProps.del),this.createElement("div",{className:"lines",cssText:" width: 16px;height: 16px;position: relative;cursor: pointer;border-radius: 50%;background: #ff4b4b;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);display: flex;align-items: center;justify-content: center;"},[this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(45deg);"}),this.createElement("div",{className:"line",cssText:" position: absolute;height: 1px;width: 60%;background: white;border-radius: 1px;transition: all 0.3s ease;top: 50%;transform: translateY(-50%) rotate(-45deg);"})]))),this.createElement("div",Object.assign({},this.defaultProps.seq),e)])}createElement(e,...t){const r="object"!=typeof t[0]||Array.isArray(t[0])?{}:t.shift();let s=t.flat(1/0);const i=document.createElement(e);((e,t)=>{t.cssText&&(e.style.cssText=t.cssText,Reflect.deleteProperty(t,"cssText")),t.style&&("string"==typeof t.style?e.style.cssText=t.style:"object"==typeof t.style&&Object.assign(e.style,t.style),Reflect.deleteProperty(t,"style"))})(i,r);for(const[e,t]of Object.entries(r))if("className"!==e||"string"!=typeof t)if("htmlFor"!==e||"string"!=typeof t)if(/^on[A-Z]/.test(e)&&"function"==typeof t){const r=e.slice(2).toLowerCase();i.addEventListener(r,t)}else"style"!==e?"boolean"!=typeof t?i.setAttribute(e,t):t?i.setAttribute(e,""):i.removeAttribute(e):"object"==typeof t?Object.assign(i.style,t):"string"==typeof t&&(i.style.cssText=t);else i.setAttribute("for",t);else i.className=t;return s=s.flat(1/0).filter((e=>null!=e&&!1!==e)).map((e=>"string"==typeof e||"number"==typeof e?document.createTextNode(String(e)):e)),s.forEach((e=>{e instanceof Node?i.appendChild(e):console.warn("Invalid child element:",e)})),i}delHotArea(e){const t=e.closest(".hot-square");if(t){const e=1*t.querySelector(".hot-seq").innerText,r=()=>{t.remove(),this.resetHotSeq(e)};"function"==typeof this.options.beforeDel?this.options.beforeDel(e,t,r):r()}}resetHotSeq(e){if(!this.container)return;this.container.querySelectorAll(".hot-square").forEach((t=>{const r=t.querySelector(".hot-seq");if(r){const t=Number(r.innerText);t>e&&(r.innerText=String(t-1))}}))}handleMouseDown(e){if(e.preventDefault(),!this.canvas)return;const{target:t}=e,r=t.className,s=t.closest(".hot-del");if(s)return this.delHotArea(s);let i=null;if(["lt","lm","lb","bm","br","rm","rt","tm","hot-square"].includes(r)){const s="hot-square"===r?t:t.closest(".hot-square"),n=this.canvas.querySelector(".hot-active");n&&n.parentElement!==s&&(n.classList.remove("hot-active"),n.style.display="none"),i=s.querySelector(".hot-content"),i&&!i.classList.contains("hot-active")&&(i.classList.add("hot-active"),i.style.display="block",s.style.zIndex=String(this.getMaxZIndex()+1)),this.startDrag(e,s,r,i)}else if("hot-container"===r&&"manual"===this.options.addMode){const t=this.canvas.getBoundingClientRect(),r=t.left,s=t.top;let i=e.clientX-r,n=e.clientY-s;const o=this.createElement("div",{className:"hot-line",style:{left:i+"px",top:n+"px",width:"0px",height:"0px",border:"1px solid red",boxSizing:"border-box",position:"absolute"}});this.canvas.appendChild(o);let a=0,u=0;const l=o.offsetLeft,c=o.offsetTop,d=this.canvas.offsetWidth-l,h=this.canvas.offsetHeight-c,p=o.offsetWidth,f=o.offsetHeight;document.onmousemove=t=>{const{clientX:m,clientY:g}=t,y=e.clientX-m,b=e.clientY-g,v=m-r-i,w=g-s-n;let x=v,F=w;m<e.clientX?(x=p+y,x=x>l?l:x,i=m-r,i=i<0?0:i):x=v>d?d:v,g<e.clientY?(F=f+b,F=F>c?c:F,n=g-s,n=n<0?0:n):F=w>h?h:w,o.style.left=i+"px",o.style.top=n+"px",o.style.width=x+"px",o.style.height=F+"px",a=x,u=F},document.onmouseup=e=>{var t,r;o&&(null===(t=this.canvas)||void 0===t||t.removeChild(o));const s=()=>this.addHotArea({x:i+"px",y:n+"px",w:a+"px",h:u+"px"},!0);if("manual"===(null===(r=this.options)||void 0===r?void 0:r.addMode)&&a>16&&u>16)if("function"==typeof this.options.manualAdd){const e=this.hasBackgroundImage();!0!==this.options.customUpload?this.options.manualAdd(s)&&s():!0===this.options.customUpload&&e&&this.options.manualAdd(s)&&s()}else s();document.onmousemove=null,document.onmouseup=null}}}startDrag(e,t,r,s){var i,n;const{clientX:o,clientY:a}=e,u=t.offsetWidth,l=t.offsetHeight,c=parseInt(t.style.left)||0,d=parseInt(t.style.top)||0,h=(null===(i=this.canvas)||void 0===i?void 0:i.offsetWidth)||0,p=(null===(n=this.canvas)||void 0===n?void 0:n.offsetHeight)||0,f=h-u,m=p-l;document.onmousemove=e=>{this.handleMouseMove(e,r,t,o,a,u,l,c,d,f,m,20,h,p)},document.onmouseup=()=>{var e,t;null===(t=null===(e=this.options)||void 0===e?void 0:e.overlapCallback)||void 0===t||t.call(e,this.areElementsOverlapping(this.canvas)),s&&(s.style.opacity="1"),document.onmousemove=null,document.onmouseup=null}}handleMouseMove(e,t,r,s,i,n,o,a,u,l,c,d,h,p){const f=e.clientX-s,m=e.clientY-i;switch(t){case"hot-square":this.moveSquare(r,a,u,f,m,l,c);break;case"lt":this.resizeLT(r,n,o,a,u,f,m,d,h,p);break;case"lb":this.resizeLB(r,n,o,a,u,f,m,d,h,p);break;case"rt":this.resizeRT(r,n,o,a,u,f,m,d,h,p);break;case"br":this.resizeBR(r,n,o,a,u,f,m,d,h,p);break;case"lm":this.resizeLM(r,n,a,f,d,h);break;case"rm":this.resizeRM(r,n,a,f,d,h);break;case"tm":this.resizeTM(r,o,u,m,d,p);break;case"bm":this.resizeBM(r,o,u,m,d,p)}}moveSquare(e,t,r,s,i,n,o){const a=Math.max(0,Math.min(t+s,n)),u=Math.max(0,Math.min(r+i,o));e.style.left=`${a}px`,e.style.top=`${u}px`}resizeLT(e,t,r,s,i,n,o,a,u,l){let c=t+(n=-n),d=s-n,h=r+(o=-o),p=i-o;c<a&&(c=a,d=s+t-a),d<0&&(d=0,c=t+s),d+c>u&&(c=u-d),h<a&&(h=a,p=i+r-a),p<0&&(p=0,h=r+i),p+h>l&&(h=l-p),e.style.width=`${c}px`,e.style.height=`${h}px`,e.style.left=`${d}px`,e.style.top=`${p}px`}resizeLB(e,t,r,s,i,n,o,a,u,l){let c=t-n,d=s+n,h=r+o;c<a&&(c=a,d=s+(t-a)),d<0&&(d=0,c=t+s),d+c>u&&(c=u-d),h<a&&(h=a),i+h>l&&(h=l-i),e.style.width=`${c}px`,e.style.left=`${d}px`,e.style.height=`${h}px`}resizeRT(e,t,r,s,i,n,o,a,u,l){let c=t+n,d=r+(o=-o),h=i-o;c<a&&(c=a),s+c>u&&(c=u-s),d<a&&(d=a,h=i+r-a),h<0&&(h=0,d=r+i),h+d>l&&(d=l-h),e.style.width=`${c}px`,e.style.height=`${d}px`,e.style.top=`${h}px`}resizeBR(e,t,r,s,i,n,o,a,u,l){let c=t+n,d=r+o;c<a&&(c=a),s+c>u&&(c=u-s),d<a&&(d=a),i+d>l&&(d=l-i),e.style.width=`${c}px`,e.style.height=`${d}px`}resizeLM(e,t,r,s,i,n){let o=t-s,a=r+s;o<i&&(o=i,a=r+(t-i)),a<0&&(a=0,o=t+r),a+o>n&&(o=n-a),e.style.width=`${o}px`,e.style.left=`${a}px`}resizeRM(e,t,r,s,i,n){let o=t+s;o<i&&(o=i),r+o>n&&(o=n-r),e.style.width=`${o}px`}resizeTM(e,t,r,s,i,n){let o=t+(s=-s),a=r-s;o<i&&(o=i,a=r+t-i),a<0&&(a=0,o=t+r),a+o>n&&(o=n-a),e.style.height=`${o}px`,e.style.top=`${a}px`}resizeBM(e,t,r,s,i,n){let o=t+s;o<i&&(o=i),r+o>n&&(o=n-r),e.style.height=`${o}px`}uploadHotImg(e){return new Promise(((t,r)=>{var s;const i=new Image;i.src=e,i.style.cssText="position:absolute;left:0;top:0;opacity:0",null===(s=this.container)||void 0===s||s.appendChild(i),i.onload=()=>{this.scaleCalc(i.offsetWidth,i.offsetHeight,e,t),i.remove()},i.onerror=()=>{i.remove(),r(new Error("Image load error"))}}))}scaleCalc(e,t,r,s){var i,n;if(this.isInit||this.resetInit(),!this.container||!this.canvas)return;const{offsetWidth:o,offsetHeight:a}=this.container,u=e/t,l=o/a;let c;c="auto"===this.options.scaleMode&&e<o&&t<a?1:u>l?o/e:a/t,this.canvas.style.cssText=`\n      position: absolute;\n      width: ${e*c}px;\n      height: ${t*c}px;\n      background-image: url(${r});\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center;\n      box-sizing: border-box;\n      border: 1px dashed #ccc;\n    `;const d=(null===(n=null===(i=this.options)||void 0===i?void 0:i.style)||void 0===n?void 0:n.canvas)||{};Object.keys(d).forEach((e=>{this.canvas&&(this.canvas.style[e]=d[e])})),this.scale=c,this.hotImgWidth=e*c,this.hotImgHeight=t*c,s({w:this.hotImgWidth,h:this.hotImgHeight,scale:this.scale})}hasBackgroundImage(){if(!this.canvas)return!1;const e=getComputedStyle(this.canvas).backgroundImage;return"none"!==e&&e.includes("url(")}delImage(){var e;this.canvas&&(this.canvas.style.backgroundImage="none",this.canvas.style.display="none",null===(e=this.container)||void 0===e||e.querySelectorAll(".hot-square").forEach((e=>e.remove())))}destroy(){var e,t,r;null===(e=this.container)||void 0===e||e.querySelectorAll(".hot-square").forEach((e=>e.remove())),null===(t=this.canvas)||void 0===t||t.remove(),null===(r=this.container)||void 0===r||r.removeEventListener("mousedown",this.handleMouseDownFunc),this.canvas=null,this.isInit=!1,this.container=null}getMaxZIndex(){var e;const t=null===(e=this.container)||void 0===e?void 0:e.querySelectorAll(".hot-square");return(null==t?void 0:t.length)?Math.max(...Array.from(t).map((e=>parseInt(getComputedStyle(e).zIndex)||1))):1}areElementsOverlapping(e=this.canvas){const t=e.querySelectorAll(".hot-square"),r=t.length;for(let e=0;e<r;e++){const s=t[e].getBoundingClientRect();for(let i=e+1;i<r;i++){const e=t[i].getBoundingClientRect();if(!(e.left>s.right||e.right<s.left||e.top>s.bottom||e.bottom<s.top))return!0}}return!1}getHotAreaData(e="array"){const t=this.container.querySelectorAll(".hot-square"),r=Array.from(t).reduce(((e,t)=>{const r=t.querySelector(".hot-seq");if(!r)return e;const s=parseInt(r.innerText)-1,i=parseFloat(t.style.left||"0"),n=parseFloat(t.style.top||"0"),o=e;return o[s]={x:i,y:n,w:t.offsetWidth,h:t.offsetHeight,index:s},o}),{});return"array"===e?Object.values(r):r}},e.JumpWithParameters=class{constructor(){this.mapKey="JUMPWITHPARAMETERS",this.initCachedData()}initCachedData(){const e=k.get(this.mapKey);e?this.cachedData=e:(k.set(this.mapKey,{}),this.cachedData={})}getCachedData(e){return this.cachedData[e]}setCachedData(e,t,r){this.cachedData[e]=t,k.set(this.mapKey,this.cachedData),r&&r(e)}clearCachedData(e){this.cachedData[e]&&(delete this.cachedData[e],k.set(this.mapKey,this.cachedData))}},e.add=A,e.addStyleCss=function(e,t){const r=[...document.styleSheets].find((t=>{var r;return(null===(r=t.ownerNode)||void 0===r?void 0:r.id)===e}));if(r){for(let e=0;e<t.length;e++)r.insertRule(t[e]);return r}{const e=document.createElement("style");return e.id="add_style_css_"+Date.now(),document.body.appendChild(e),e.onload=()=>{const r=[...document.styleSheets].find((t=>{var r;return(null===(r=t.ownerNode)||void 0===r?void 0:r.id)===e.id}));for(let e=0;e<t.length;e++)r.insertRule(t[e])},e}},e.arrayGroup=function(e,t){if(0===e.length)return[];const r=[];let s=0;for(let i=1,n=e.length;i<n;i++){const n=e[i-1],o=e[i];n[t]!==o[t]&&(r.push(e.slice(s,i)),s=i)}return r.push(e.slice(s)),r},e.arrayRestore=function(e,t,r,i=!1){return i||(e=s(e)),e.splice(t,0,e.splice(r,1)[0]),e},e.arrayToTree=function e(t,r=null,s="id",i="pid",n="children"){return t.filter((e=>e[i]===r)).map((r=>Object.assign(Object.assign({},r),{[n]:e(t,r[s],s,i,n)})))},e.attrFilter=function(e,t={}){return Object.keys(e).reduce(((r,s)=>(t.isEmptyZero&&0===e[s]||t.isEmptyObject&&"[object Object]"===Object.prototype.toString.call(e[s])&&!Object.keys(e[s]).length||t.isEmptyArray&&Array.isArray(e[s])&&!e[s].length||t.isNull&&null===e[s]||t.isEmptyString&&""===e[s]||!0===t.isFalse&&!1===e[s]||(r[s]=e[s]),r)),{})},e.base64ToBlob=b,e.base64ToFile=function(e,t){let r=e.split(","),s=r[0].match(/:(.*?);/)[1],i=atob(r[1]),n=i.length,o=new Uint8Array(n);for(;n--;)o[n]=i.charCodeAt(n);return new File([o],t,{type:s})},e.bfs=r,e.blobToBase64=function(e){return new Promise(((t,r)=>{const s=new FileReader;s.onload=function(e){t(e.target.result)},s.onerror=function(e){r(e)},s.readAsDataURL(e)}))},e.blobToFile=function(e,t){return new File([e],t,{type:e.type,lastModified:Date.now()})},e.browser=y,e.bufferFileDownload=function(e,t){const r=new Blob([e],{type:"charset=utf-8"}),s=document.createElement("a"),i=window.URL.createObjectURL(r);s.href=i,s.download=t;const n=document.getElementsByTagName("body")[0];n.appendChild(s),s.click(),n.removeChild(s),window.URL.revokeObjectURL(i)},e.bytesFormat=function(e){if(0===e)return"0 B";if(!e)return"";let t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},e.calc=D,e.copyText=function(e){const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},e.debounce=function(e,t,r){let s=null;return function(...i){if(r){const r=!s;s=setTimeout((()=>{s=null}),t),r&&e.apply(this,i)}else s&&clearTimeout(s),s=setTimeout((()=>{e.apply(this,i)}),t)}},e.deepClone=s,e.delBy=function(e,t,r=!1){if(!Array.isArray(e))throw new Error("First argument must be an array.");if("function"!=typeof t&&!Array.isArray(t)&&("object"!=typeof t||null===t))throw new Error("Second argument must be a function, array, or object.");if("boolean"!=typeof r)throw new Error("Third argument must be a boolean.");const i=r?e:s(e);for(let e=i.length-1;e>=0;e--)if("function"==typeof t)t(i[e])&&i.splice(e,1);else if(Array.isArray(t))t.indexOf(i[e])>-1&&i.splice(e,1);else if(i[e]===t)i.splice(e,1);else if("Object"===Object.prototype.toString.call(t).slice(8,-1)){let r=i[e];for(let s in t)Array.isArray(t[s])?t[s].indexOf(r[s])>-1&&i.splice(e,1):t[s]===r[s]&&i.splice(e,1)}return i},e.difference=function(e,t,r){return r?e.filter((e=>!t.some((t=>e[r]===t[r])))):e.filter((e=>!t.includes(e)))},e.div=C,e.downloadByBase64=function(e,t="default"){const r=document.createElement("a");if(r.style.display="none",document.body.appendChild(r),r.download=t,r.href=e,document.createEvent){const e=document.createEvent("MouseEvents");e.initEvent("click",!0,!1),r.dispatchEvent(e)}else document.createEventObject?r.fireEvent("onclick"):"function"==typeof r.onclick&&r.onclick();document.body.removeChild(r)},e.fileToBase64=v,e.fileToBlob=function(e){return w(this,void 0,void 0,(function*(){return b(yield v(e))}))},e.filterEmoji=function(e){return e=(e=(e=e.replace(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g,"")).replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,"")).replace(/[\uE000-\uF8FF]/g,"")},e.findIndexs=function(e,t){const r=[];for(let s=0;s<e.length;s++)t(e[s])&&r.push(s);return r},e.fmtNum=function(e,t,r,s){if(void 0===e||null==e)return"";let i=F(e,r)+"";if(!/^[+-]?\d+(\.\d+)?$/.test(String(i)))return"";if(s)return Number(i);if(!t)return i;const[n,o=""]=i.split(".");return n.replace(/(?=(?!\b)(\d{3})+$)/g,",")+(o?"."+o:o)},e.formData=function(e){return Object.keys(e).reduce(((t,r)=>(t.append(r,e[r]),t)),new FormData)},e.getMaxZIndex=function(){const e=document.querySelectorAll("*");return Math.max(...Array.from(e).map((e=>parseInt(getComputedStyle(e).zIndex)||1)))},e.getQuery=function(e=window.location.href){try{const e={},t=Object.fromEntries(new URLSearchParams(window.location.search).entries());for(const r in t)e[r]=decodeURIComponent(t[r]);return e}catch(t){try{return e.includes("?")?e.split("?")[1].split("&").map((e=>e.split("="))).reduce(((e,[t,r])=>(e[decodeURIComponent(t)]=decodeURIComponent(r),e)),{}):{}}catch(e){return{}}}},e.getRepeat=function(e=[]){return e.reduce(((e,t,r,s)=>{t=Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{});const i=JSON.stringify(t);return e.countMap[i]?e.countMap[i]++:e.countMap[i]=1,r===s.length-1&&(Object.keys(e.countMap).forEach((t=>e[e.countMap[t]>1?"repeatArr":"notRepeatArr"].push(JSON.parse(t)))),delete e.countMap),e}),{repeatArr:[],notRepeatArr:[],countMap:{}})},e.getScrollDirection=function e(t=window){const r=(t=t===window?window:"string"==typeof t?document.querySelector(t):t)===window?t.scrollX:t.scrollLeft,s=t===window?t.scrollY:t.scrollTop;if(void 0===(t=t===window?e:t).oldScrollLeft&&void 0===t.oldScrollTop&&s&&r)return t.oldScrollLeft=0,t.oldScrollTop=0,t.oldScrollLeft=r,t.oldScrollTop=s,{x:!0,y:!0};void 0===t.oldScrollLeft&&(t.oldScrollLeft=0),void 0===t.oldScrollTop&&(t.oldScrollTop=0);const i=t.oldScrollTop!==s;return t.oldScrollLeft=r,t.oldScrollTop=s,{x:!i,y:i}},e.groupBy=function(e,t){return e.reduce(((e,r,s,i)=>(e[r[t]]?e[r[t]].push(r):e[r[t]]=[r],s===i.length-1?Object.values(e):e)),{})},e.guid=function(){return Array.from({length:8},((e,t)=>(65536*(1+Math.random())|0).toString(16).substring(1)+([1,2,3,4].includes(t)?"-":""))).join("")},e.indexdb=e=>new j(e),e.intersection=function(e,t,r){return r?e.filter((e=>t.some((t=>e[r]===t[r])))):e.filter((e=>t.includes(e)))},e.isEqual=x,e.isRepeat=function(e,r){const s=e.length;if(0===s||1===s)return!!r&&{repeatIndex:-1,repeatItem:null,isRepeat:!1};try{for(let t=0;t<s;t++)for(let i=t+1;i<s;i++)if(x(e[t],e[i]))return!r||{repeatIndex:t,repeatItem:e[t],isRepeat:!0};return!!r&&{repeatIndex:-1,repeatItem:null,isRepeat:!1}}catch(i){return r?{repeatIndex:-1,repeatItem:null,isRepeat:s!==t(e).length}:s!==t(e).length}},e.isValidNum=function(e,t){return(t?/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/:/^[+-]?\d+(\.\d+)?$/).test(String(e))},e.local=M,e.make=function(e,t,r){return e.reduce(((e,s)=>[...e,{[s[t]]:s[r]}]),[])},e.moneyToChinese=function(e){let t,r,s,i=String(Math.round(100*e)),n="",o="零壹贰叁肆伍陆柒捌玖",a="万仟佰拾亿仟佰拾万仟佰拾元角分",u=i.length,l=0;if(u>15)return alert("超出计算范围"),"";if(0==e)return n="零元整",n;-1!=i.indexOf("-")?(a=a.substr(a.length-u+1,u-1),i=i.substr(1,u-1),u=i.length,n="负"):a=a.substr(a.length-u,u);for(let e=0;e<u;e++)s=parseInt(i.substr(e,1),10),e!=u-3&&e!=u-7&&e!=u-11&&e!=u-15?0==s?(t="",r="",l+=1):0!=s&&0!=l?(t="零"+o.substr(s,1),r=a.substr(e,1),l=0):(t=o.substr(s,1),r=a.substr(e,1),l=0):(0!=s&&0!=l?(t="零"+o.substr(s,1),r=a.substr(e,1),l=0):0!=s&&0==l?(t=o.substr(s,1),r=a.substr(e,1),l=0):0==s&&l>=3?(t="",r="",l+=1):(t="",r=a.substr(e,1),l+=1),(e==u-11||e==u-3)&&(r=a.substr(e,1))),n=n+t+r;return 0==s&&(n+="整"),n},e.mul=S,e.num=function(e){return new $(e)},e.pick=function(e,t){return e.reduce(((e,r)=>[...e,t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:r[t]})),{})]),[])},e.pluckDeep=e=>(t,r)=>{try{return e.split(".").reduce(((e,t)=>null==e?void 0:e[t]),t)||r}catch(e){return r}},e.queryNode=function(e,t,{idAlias:r="id",childrenAlias:i="children"}){var n;e=s(e);const o=Array.isArray(e)?e:[e];for(;o.length;){const e=o.shift();if(e[r]===t)return e;null===(n=null==e?void 0:e[i])||void 0===n||n.forEach((e=>o.push(e)))}},e.queryPath=function e(t,r,s="children",i=[]){var n;if(!t)return[];t=Array.isArray(t)?t:[t];for(const o of t){if(i.push(o),r(o))return i;if(null===(n=o[s])||void 0===n?void 0:n.length){const t=e(o[s],r,s,i);if(t.length)return t}i.pop()}return[]},e.range=function(e,t,r=0,s){if(void 0===s&&0===r)return Array.from({length:t-e+1},((t,r)=>r+e));if(s)return Array.from({length:r||0},(()=>Math.floor(Math.random()*(t-e+1))+e));{const s=Array.from({length:t-e+1},((t,r)=>r+e)),i=r>s.length?s.length:r,n=[];for(;n.length!=i;){const e=s[Math.floor(Math.random()*s.length)];!n.includes(e)&&n.push(e)}return n}},e.rangeStep=function(e,t,r){return Array.from({length:(t-e)/r+1},((t,s)=>e+s*r))},e.reg=T,e.round=F,e.selectTextByElement=function(e){const t="string"==typeof e?document.querySelector(e):e;if(document.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){const e=window.getSelection(),r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}},e.session=k,e.sub=E,e.sumBigNumber=function(e,t){let r="",s=0;for(e=e.split(""),t=t.split("");e.length||t.length||s;)s+=~~e.pop()+~~t.pop(),r=s%10+r,s=s>9;return r.replace(/^0+/,"")},e.throttle=function(e,t,r){let s,i=0;r||(r={});let n=function(...n){let o=+new Date;!1!==r.leading||i||(i=o),o-i>t?(s&&(clearTimeout(s),s=null),e.apply(this,n),i=o):s||!1===r.trailing||(s=setTimeout((()=>{i=+new Date,s=null,e.apply(this,n)}),t))};return n.cancel=function(){s&&clearTimeout(s),s=void 0,i=0},n},e.treeToArray=function e(t,r="children"){return(Array.isArray(t)?t:[t]).reduce(((t,s)=>[...t,s,...e(s[r]||[],r)]),[])},e.trigger=function(e,t){const r=document.createEvent("Events");r.initEvent(t,!0,!0),t in e?(e[t](),["blur","scroll","select"].includes(t)&&e.dispatchEvent(r)):e.dispatchEvent(r)},e.truncateTextToFit=function(e,t,r,s){const i=e.textContent||e.innerText,n=document.createElement("canvas").getContext("2d"),o=window.getComputedStyle(e).font;n.font=o.replace(/\d+px/,`${s}px`);let a="",u="",l=0;for(let e=0;e<i.length;e++){const s=i[e],o=u+s;if(n.measureText(o).width>t){if(l++,l>=r){a+=u.trim()+"...";break}a+=u.trim()+"",u=s}else u=o}return l<r&&(a+=u),a},e.union=function(e,t,r){return r?[...e,...t.filter((t=>e.find((e=>e[r]!==t[r]))))]:Array.from(new Set([...e,...t]))},e.unique=t,e.urlSerialize=function(e,t={}){return Object.keys(t).reduce(((r,s)=>r+(r===e?"?":"&")+`${s}=${encodeURIComponent(t[s])}`),e)},e.urlTmtFmt=function(e,t={},r){let s=/\{(\w+)\}/g.test(e)?e.replace(/\{(\w+)\}/g,((e,r)=>{let s=t[r];return delete t[r],s})):e;return r&&Object.keys(t).length?Object.keys(t).reduce(((e,r)=>e+(e===s?"?":"&")+`${r}=${t[r]}`),s):s},Object.defineProperty(e,"__esModule",{value:!0})}));
